var cone_protected=function(t,e,i){"use strict";void 0===window.cone&&(window.cone={});class s{static initialize(t){new s(t)}constructor(t){this.cut_cookie="cone.app.copysupport.cut",this.copy_cookie="cone.app.copysupport.copy",this.context=t,this.paste_action=e("a#toolbaraction-paste",t),this.paste_action.off("click").on("click",this.handle_paste.bind(this)),this.copyable=e("table tr.selectable.copysupportitem",t),this.copyable.length&&(this.cut_action=e("a#toolbaraction-cut",t),this.cut_action.off("click").on("click",this.handle_cut.bind(this)),this.copy_action=e("a#toolbaraction-copy",t),this.copy_action.off("click").on("click",this.handle_copy.bind(this)),this.selectable=this.copyable.selectable({on_firstclick:this.on_firstclick.bind(this),on_select:this.on_select.bind(this)}).data("selectable"),this.read_selected_from_cookie(this.cut_cookie,"copysupport_cut"),this.read_selected_from_cookie(this.copy_cookie,""))}on_firstclick(t,e){}on_select(t){}write_selected_to_cookie(t){let s=e(this.selectable.selected),a=new Array;s.each((function(){a.push(e(this).attr("ajax:target"))}));let c=a.join("::");i.create_cookie(t,c),c.length?e(this.paste_action).removeClass("disabled"):e(this.paste_action).addClass("disabled")}read_selected_from_cookie(t,s){let a=i.read_cookie(t);if(!a)return;let c,o,l=a.split("::"),r=this;e("table tr.selectable",this.context).each((function(){c=e(this),o=c.attr("ajax:target");for(let t in l)if(l[t]==o){c.addClass("selected"),s&&c.addClass(s),r.selectable.add(c.get(0));break}}))}handle_cut(t){t.preventDefault(),i.create_cookie(this.copy_cookie,"",0),this.write_selected_to_cookie(this.cut_cookie),this.copyable.removeClass("copysupport_cut"),e(this.selectable.selected).addClass("copysupport_cut")}handle_copy(t){t.preventDefault(),i.create_cookie(this.cut_cookie,"",0),this.write_selected_to_cookie(this.copy_cookie),this.copyable.removeClass("copysupport_cut")}handle_paste(t){t.preventDefault();let s=e(t.currentTarget);if(s.hasClass("disabled"))return;let a=i.ajax.parsetarget(s.attr("ajax:target"));i.ajax.action({name:"paste",mode:"NONE",selector:"NONE",url:a.url,params:a.params})}}class a{static initialize(t){new a(t)}constructor(t){this.tabs=e("ul.settingstabs a",t),this.tabs.on("click",this.load_tab).first().trigger("click")}load_tab(t){t.preventDefault();let s=e(this),a=i.ajax.parsetarget(s.attr("ajax:target"));i.ajax.request({url:a.url,params:a.params,success:function(t,i,a){let c=e(s).parent().parent();e("li",c).removeClass("active"),s.parent().addClass("active"),e(".settingstabpane").html(t).css("display","block").tsajax()}})}}class c{static initialize(t){new c(t,".batched_items_slice_size select",".batched_items_filter input","term")}constructor(t,e,i,s){this.context=t,this.size_selector=e,this.filter_selector=i,this.filter_name=s,this.bind_size(),this.bind_search()}bind_size(){e(this.size_selector,this.context).off("change").on("change",function(t){let i=e(t.currentTarget),s=e("option:selected",i).first();this.set_filter(i,"size",s.val())}.bind(this))}bind_search(){let t=e(this.filter_selector,this.context);t.hasClass("empty_filter")&&t.on("focus",(function(){this.value="",e(this).removeClass("empty_filter")})),t.off("keypress").on("keypress",(function(t){13==t.keyCode&&t.preventDefault()})),t.off("keyup").on("keyup",function(t){if(13==t.keyCode){t.preventDefault();let i=e(t.currentTarget);this.set_filter(i,this.filter_name,i.attr("value"))}}.bind(this)),t.off("change").on("change",function(t){t.preventDefault();let i=e(t.currentTarget);this.set_filter(i,this.filter_name,i.attr("value"))}.bind(this))}set_filter(t,e,s){let a=i.ajax.parsetarget(t.attr("ajax:target")),c=t.attr("ajax:event");if(a.params[e]=s,t.attr("ajax:path")){let o=t.attr("ajax:path-event");o||(o=c),i.ajax.path({path:a.path+a.query+"&"+e+"="+s,event:o,target:a})}let o=c.split(":");i.ajax.trigger(o[0],o[1],a)}}class o extends c{static initialize(t){new o(t,".table_length select",".table_filter input","term")}constructor(t,e,i,s){super(t,e,i,s)}}class l{static initialize(t){new l(t)}constructor(t){e("input.add_remove_role_for_principal",t).off("change").on("change",this.set_principal_role)}set_principal_role(t){t.preventDefault();let s,a=e(this);s=this.checked?"add_principal_role":"remove_principal_role";let c=a.parent().attr("ajax:target"),o={id:a.attr("name"),role:a.attr("value")};i.ajax.action({name:s,mode:"NONE",selector:"NONE",url:c,params:o})}}let r={shift_down:!1,ctrl_down:!1};class n{constructor(){e(window).on("keydown",this.key_down.bind(this)),e(window).on("keyup",this.key_up.bind(this))}key_down(t){switch(t.keyCode||t.which){case 16:r.shift_down=!0;break;case 17:r.ctrl_down=!0}}key_up(t){switch(t.keyCode||t.which){case 16:r.shift_down=!1;break;case 17:r.ctrl_down=!1}}}class h{constructor(t){this.options=t,this.selected=[],this.select_direction=0,this.firstclick=!0}reset(){this.selected=[]}add(t){this.remove(t),this.selected.push(t)}remove(t){let i=e.grep(this.selected,(function(e,i){return e!==t}));this.selected=i}select_no_key(t,e){t.children().removeClass("selected"),e.addClass("selected"),this.reset(),this.add(e.get(0))}select_ctrl_down(t){t.toggleClass("selected"),t.hasClass("selected")?this.add(t.get(0)):this.remove(t.get(0))}get_nearest(t,i){let s,a,c=t.children(".selected"),o=-1;return e(c).each((function(){a=e(this),s=a.index(),-1==o?o=s:i>s?this.select_direction>0?s<o&&(o=s):s>o&&(o=s):i<s&&s<o&&(o=s)})),o}select_shift_down(t,e){let i=e.index(),s=this.get_nearest(t,i);if(-1==s)e.addClass("selected"),this.add(e.get(0));else{let e,a;t.children().removeClass("selected"),i<s?(this.select_direction=-1,e=i,a=s):(this.select_direction=1,e=s,a=i),this.reset();let c=this;t.children().slice(e,a+1).addClass("selected").each((function(){c.add(this)}))}}handle_click(t){t.preventDefault();let i=e(t.currentTarget),s=i.parent();r.ctrl_down||r.shift_down?r.ctrl_down?this.select_ctrl_down(i):r.shift_down&&this.select_shift_down(s,i):this.select_no_key(s,i),this.firstclick&&(this.firstclick=!1,this.notify("on_firstclick",this,i)),this.notify("on_select",this)}notify(t,...e){this.options&&this.options[t]&&this.options[t](...e)}bind(t){t.off("click").on("click",this.handle_click.bind(this))}}return e.fn.selectable=function(t){var e=new h(t);return e.bind(this),this.data("selectable",e),this},e((function(){new n,i.ajax.register(a.initialize,!0),i.ajax.register(c.initialize,!0),i.ajax.register(o.initialize,!0),i.ajax.register(l.initialize,!0),i.ajax.register(s.initialize,!0)})),t.BatchedItems=c,t.CopySupport=s,t.KeyBinder=n,t.Selectable=h,t.SettingsTabs=a,t.Sharing=l,t.TableToolBar=o,t.keys=r,Object.defineProperty(t,"__esModule",{value:!0}),Object.assign(window.cone,t),t}({},jQuery,treibstoff);
