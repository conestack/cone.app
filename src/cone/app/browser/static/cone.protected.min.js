!function(e,t,i){"use strict";class a{static initialize(e){a.bind_size(e),a.bind_search(e)}static set_filter(e,t,a){let s=i.ajax.parsetarget(e.attr("ajax:target")),r=e.attr("ajax:event");if(s.params[t]=a,e.attr("ajax:path")){let c=e.attr("ajax:path-event");c||(c=r),i.ajax.path({path:s.path+s.query+"&"+t+"="+a,event:c,target:s})}let c=r.split(":");i.ajax.trigger(c[0],c[1],s)}static bind_size(e,i=".batched_items_slice_size select"){t(i,e).off("change").on("change",(function(e){let i=t(e.currentTarget),s=t("option:selected",i).first();a.set_filter(i,"size",s.val())}))}static bind_search(e,i=".batched_items_filter input",s="term"){let r=t(i,e);r.hasClass("empty_filter")&&r.on("focus",(function(){this.value="",t(this).removeClass("empty_filter")})),r.off("keypress").on("keypress",(function(e){13==e.keyCode&&e.preventDefault()})),r.off("keyup").on("keyup",(function(e){if(13==e.keyCode){e.preventDefault();let i=t(this);a.set_filter(i,s,i.attr("value"))}})),r.off("change").on("change",(function(e){e.preventDefault();let i=t(this);a.set_filter(i,s,i.attr("value"))}))}}class s{static initialize(e){new s(e)}constructor(e){this.cut_cookie="cone.app.copysupport.cut",this.copy_cookie="cone.app.copysupport.copy",this.context=e,this.paste_action=t("a#toolbaraction-paste",e),this.paste_action.off("click").on("click",this.handle_paste.bind(this)),this.copyable=t("table tr.selectable.copysupportitem",e),this.copyable.length&&(this.cut_action=t("a#toolbaraction-cut",e),this.cut_action.off("click").on("click",this.handle_cut.bind(this)),this.copy_action=t("a#toolbaraction-copy",e),this.copy_action.off("click").on("click",this.handle_copy.bind(this)),this.selectable=this.copyable.selectable({on_firstclick:this.on_firstclick.bind(this),on_select:this.on_select.bind(this)}).data("selectable"),this.read_selected_from_cookie(this.cut_cookie,"copysupport_cut"),this.read_selected_from_cookie(this.copy_cookie,""))}on_firstclick(e,t){}on_select(e){}write_selected_to_cookie(e){let a=t(this.selectable.selected),s=new Array;a.each((function(){s.push(t(this).attr("ajax:target"))}));let r=s.join("::");i.create_cookie(e,r),r.length?t(this.paste_action).removeClass("disabled"):t(this.paste_action).addClass("disabled")}read_selected_from_cookie(e,a){let s=i.read_cookie(e);if(!s)return;let r,c,l=s.split("::"),n=this;t("table tr.selectable",this.context).each((function(){r=t(this),c=r.attr("ajax:target");for(let e in l)if(l[e]==c){r.addClass("selected"),a&&r.addClass(a),n.selectable.add(r.get(0));break}}))}handle_cut(e){e.preventDefault(),i.create_cookie(this.copy_cookie,"",0),this.write_selected_to_cookie(this.cut_cookie),this.copyable.removeClass("copysupport_cut"),t(this.selectable.selected).addClass("copysupport_cut")}handle_copy(e){e.preventDefault(),i.create_cookie(this.cut_cookie,"",0),this.write_selected_to_cookie(this.copy_cookie),this.copyable.removeClass("copysupport_cut")}handle_paste(e){e.preventDefault();let a=t(e.currentTarget);if(a.hasClass("disabled"))return;let s=i.ajax.parsetarget(a.attr("ajax:target"));i.ajax.action({name:"paste",mode:"NONE",selector:"NONE",url:s.url,params:s.params})}}let r={shift_down:!1,ctrl_down:!1};class c{constructor(){t(window).on("keydown",this.key_down.bind(this)),t(window).on("keyup",this.key_up.bind(this))}key_down(e){switch(e.keyCode||e.which){case 16:r.shift_down=!0;break;case 17:r.ctrl_down=!0}}key_up(e){switch(e.keyCode||e.which){case 16:r.shift_down=!1;break;case 17:r.ctrl_down=!1}}}class l{static initialize(e){if(!e)return;let i=e.parents("div.modal");if(!i.length)return;let a=i.data("overlay"),s=a.ref_target;t("a.addreference",e).each((function(){new n(t(this),s,a)})),t("a.removereference",e).each((function(){new o(t(this),s)}))}constructor(e){this.target=e,this.target_tag=e.get(0).tagName}single_value(){return"INPUT"==this.target_tag}multi_value(){return"SELECT"==this.target_tag.tagName}toggle_enabled(e){t("a",e.parent()).toggleClass("disabled")}reset_selected(e){let i=new Array;this.single_value()&&i.push(e.attr("value")),this.multi_value()&&t("[selected=selected]",e).each((function(){i.push(t(this).attr("value"))})),this.set_selected_on_ajax_target(e.parent(),i);let a=this.overlay().getOverlay(),s=this;t("div.referencebrowser a",a.elem).each((function(){let e=t(this);e.attr("ajax:target")&&s.set_selected_on_ajax_target(e,i)}))}set_selected_on_ajax_target(e,t){let a=i.ajax.parsetarget(e.attr("ajax:target"));a.params.selected=t.join(",");let s=new Array;for(let e in a.params)s.push(e+"="+a.params[e]);e.attr("ajax:target",a.url+"?"+s.join("&"))}}class n extends l{constructor(e,t,i){super(t),this.elem=e,this.overlay=i,e.off("click").on("click",this.add_reference.bind(this))}add_reference(e){e.preventDefault();let i=this.elem,a=this.target,s=i.attr("id");s=s.substring(4,s.length);let r=t(".reftitle",i.parent()).html();if(this.single_value()){a.attr("value",r);let e='[name="'+a.attr("name")+'.uid"]';return t(e).attr("value",s),this.set_selected_on_ajax_target(a.parent(),[s]),void this.overlay.close()}if(this.multi_value()){if(t('[value="'+s+'"]',a.parent()).length)return;let e=t("<option></option>");e.val(s).html(r).attr("selected","selected"),a.append(e)}this.reset_selected(a),this.toggle_enabled(i)}}class o extends l{constructor(e,t){super(t),this.elem=e,e.off("click").on("click",this.remove_reference.bind(this))}remove_reference(e){e.preventDefault();let i=this.elem,a=this.target,s=i.attr("id");if(s=s.substring(4,s.length),this.single_value()){a.attr("value","");let e='[name="'+a.attr("name")+'.uid"]';t(e).attr("value","")}if(this.multi_value()){let e='[value="'+s+'"]';if(!t(e,a.parent()).length)return;t(e,a).remove()}this.reset_selected(a),this.toggle_enabled(i)}}class h{static initialize(e){t(".referencebrowser_trigger",e).each((function(){new h(t(this))}))}constructor(e){this.wrapper=e.parent();let i=`[name="${e.data("reference-name")}"]`;this.target=t(i,this.wrapper),e.off("click").on("click",this.load_ref_browser.bind(this))}load_ref_browser(e){e.preventDefault(),i.ajax.overlay({action:"referencebrowser",target:this.wrapper.attr("ajax:target"),on_complete:this.on_complete.bind(this)}).ref_target=this.target}on_complete(e){let i=this.target;t("a.addreference",e.elem).each((function(){new n(t(this),i,e)})),t("a.removereference",e.elem).each((function(){new o(t(this),i)}))}}class d{static initialize(e){new d(e)}constructor(e){this.tabs=t("ul.settingstabs a",e),this.tabs.on("click",this.load_tab).first().trigger("click")}load_tab(e){e.preventDefault();let a=t(this),s=i.ajax.parsetarget(a.attr("ajax:target"));i.ajax.request({url:s.url,params:s.params,success:function(e,i,s){let r=t(a).parent().parent();t("li",r).removeClass("active"),a.parent().addClass("active"),t(".settingstabpane").html(e).css("display","block").tsajax()}})}}class _{static initialize(e){new _(e)}constructor(e){t("input.add_remove_role_for_principal",e).off("change").on("change",this.set_principal_role)}set_principal_role(e){e.preventDefault();let a,s=t(this);a=this.checked?"add_principal_role":"remove_principal_role";let r=s.parent().attr("ajax:target"),c={id:s.attr("name"),role:s.attr("value")};i.ajax.action({name:a,mode:"NONE",selector:"NONE",url:r,params:c})}}class p{static initialize(e){a.bind_size(e,".table_length select"),a.bind_search(e,".table_filter input")}}class u{constructor(e){this.options=e,this.selected=[],this.select_direction=0,this.firstclick=!0}reset(){this.selected=[]}add(e){this.remove(e),this.selected.push(e)}remove(e){let i=t.grep(this.selected,(function(t,i){return t!==e}));this.selected=i}select_no_key(e,t){e.children().removeClass("selected"),t.addClass("selected"),this.reset(),this.add(t.get(0))}select_ctrl_down(e){e.toggleClass("selected"),e.hasClass("selected")?this.add(e.get(0)):this.remove(e.get(0))}get_nearest(e,i){let a,s,r=e.children(".selected"),c=-1;return t(r).each((function(){s=t(this),a=s.index(),-1==c?c=a:i>a?this.select_direction>0?a<c&&(c=a):a>c&&(c=a):i<a&&a<c&&(c=a)})),c}select_shift_down(e,t){let i=t.index(),a=this.get_nearest(e,i);if(-1==a)t.addClass("selected"),this.add(t.get(0));else{let t,s;e.children().removeClass("selected"),i<a?(this.select_direction=-1,t=i,s=a):(this.select_direction=1,t=a,s=i),this.reset();let r=this;e.children().slice(t,s+1).addClass("selected").each((function(){r.add(this)}))}}handle_click(e){e.preventDefault();let i=t(e.currentTarget),a=i.parent();r.ctrl_down||r.shift_down?r.ctrl_down?this.select_ctrl_down(i):r.shift_down&&this.select_shift_down(a,i):this.select_no_key(a,i),this.firstclick&&(this.firstclick=!1,this.notify("on_firstclick",this,i)),this.notify("on_select",this)}notify(e,...t){this.options&&this.options[e]&&this.options[e](...t)}bind(e){e.off("click").on("click",this.handle_click.bind(this))}}function f(e,t,a){i.deprecate("createCookie","ts.create_cookie","1.1"),i.create_cookie(e,t,a)}function g(e){return i.deprecate("readCookie","ts.read_cookie","1.1"),i.read_cookie(e)}t.fn.selectable=function(e){var t=new u(e);return t.bind(this),this.data("selectable",t),this},t((function(){new c,i.ajax.register(a.initialize,!0),i.ajax.register(s.initialize,!0),i.ajax.register(h.initialize,!0),i.ajax.register(l.initialize,!0),i.ajax.register(d.initialize,!0),i.ajax.register(_.initialize,!0),i.ajax.register(p.initialize,!0)})),e.AddReferenceHandle=n,e.BatchedItems=a,e.CopySupport=s,e.KeyBinder=c,e.ReferenceBrowserLoader=h,e.ReferenceHandle=l,e.RemoveReferenceHandle=o,e.Selectable=u,e.SettingsTabs=d,e.Sharing=_,e.TableToolbar=p,e.batcheditems_filter_binder=function(e,t,s){i.deprecate("batcheditems_filter_binder","BatchedItems.bind_search","1.1"),t||(t=".batched_items_filter input"),s||(s="term"),a.bind_search(e,t,s)},e.batcheditems_handle_filter=function(e,t,s){i.deprecate("batcheditems_handle_filter","BatchedItems.set_filter","1.1"),a.set_filter(e,t,s)},e.batcheditems_size_binder=function(e,t){i.deprecate("batcheditems_size_binder","BatchedItems.bind_size","1.1"),t||(t=".batched_items_slice_size select"),a.bind_size(e,t)},e.createCookie=f,e.keys=r,e.readCookie=g,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.cone&&(window.cone={}),Object.assign(window.cone,e),window.createCookie=f,window.readCookie=g}({},jQuery,treibstoff);
