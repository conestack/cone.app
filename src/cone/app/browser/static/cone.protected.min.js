!function(e,t,i){"use strict";class s{static initialize(e){new s(e,".batched_items_slice_size select",".batched_items_filter input","term")}constructor(e,t,i,s){this.context=e,this.size_selector=t,this.filter_selector=i,this.filter_name=s,this.bind_size(),this.bind_search()}bind_size(){t(this.size_selector,this.context).off("change").on("change",function(e){let i=t(e.currentTarget),s=t("option:selected",i).first();this.set_filter(i,"size",s.val())}.bind(this))}bind_search(){let e=t(this.filter_selector,this.context);e.hasClass("empty_filter")&&e.on("focus",(function(){this.value="",t(this).removeClass("empty_filter")})),e.off("keypress").on("keypress",(function(e){13==e.keyCode&&e.preventDefault()})),e.off("keyup").on("keyup",function(e){if(13==e.keyCode){e.preventDefault();let i=t(e.currentTarget);this.set_filter(i,this.filter_name,i.attr("value"))}}.bind(this)),e.off("change").on("change",function(e){e.preventDefault();let i=t(e.currentTarget);this.set_filter(i,this.filter_name,i.attr("value"))}.bind(this))}set_filter(e,t,s){let a=i.ajax.parsetarget(e.attr("ajax:target")),r=e.attr("ajax:event");if(a.params[t]=s,e.attr("ajax:path")){let l=e.attr("ajax:path-event");l||(l=r),i.ajax.path({path:a.path+a.query+"&"+t+"="+s,event:l,target:a})}let l=r.split(":");i.ajax.trigger(l[0],l[1],a)}}class a{static initialize(e){new a(e)}constructor(e){this.cut_cookie="cone.app.copysupport.cut",this.copy_cookie="cone.app.copysupport.copy",this.context=e,this.paste_action=t("a#toolbaraction-paste",e),this.paste_action.off("click").on("click",this.handle_paste.bind(this)),this.copyable=t("table tr.selectable.copysupportitem",e),this.copyable.length&&(this.cut_action=t("a#toolbaraction-cut",e),this.cut_action.off("click").on("click",this.handle_cut.bind(this)),this.copy_action=t("a#toolbaraction-copy",e),this.copy_action.off("click").on("click",this.handle_copy.bind(this)),this.selectable=this.copyable.selectable({on_firstclick:this.on_firstclick.bind(this),on_select:this.on_select.bind(this)}).data("selectable"),this.read_selected_from_cookie(this.cut_cookie,"copysupport_cut"),this.read_selected_from_cookie(this.copy_cookie,""))}on_firstclick(e,t){}on_select(e){}write_selected_to_cookie(e){let s=t(this.selectable.selected),a=new Array;s.each((function(){a.push(t(this).attr("ajax:target"))}));let r=a.join("::");i.create_cookie(e,r),r.length?t(this.paste_action).removeClass("disabled"):t(this.paste_action).addClass("disabled")}read_selected_from_cookie(e,s){let a=i.read_cookie(e);if(!a)return;let r,l,c=a.split("::"),n=this;t("table tr.selectable",this.context).each((function(){r=t(this),l=r.attr("ajax:target");for(let e in c)if(c[e]==l){r.addClass("selected"),s&&r.addClass(s),n.selectable.add(r.get(0));break}}))}handle_cut(e){e.preventDefault(),i.create_cookie(this.copy_cookie,"",0),this.write_selected_to_cookie(this.cut_cookie),this.copyable.removeClass("copysupport_cut"),t(this.selectable.selected).addClass("copysupport_cut")}handle_copy(e){e.preventDefault(),i.create_cookie(this.cut_cookie,"",0),this.write_selected_to_cookie(this.copy_cookie),this.copyable.removeClass("copysupport_cut")}handle_paste(e){e.preventDefault();let s=t(e.currentTarget);if(s.hasClass("disabled"))return;let a=i.ajax.parsetarget(s.attr("ajax:target"));i.ajax.action({name:"paste",mode:"NONE",selector:"NONE",url:a.url,params:a.params})}}let r={shift_down:!1,ctrl_down:!1};class l{constructor(){t(window).on("keydown",this.key_down.bind(this)),t(window).on("keyup",this.key_up.bind(this))}key_down(e){switch(e.keyCode||e.which){case 16:r.shift_down=!0;break;case 17:r.ctrl_down=!0}}key_up(e){switch(e.keyCode||e.which){case 16:r.shift_down=!1;break;case 17:r.ctrl_down=!1}}}class c{static initialize(e){if(!e)return;let i=e.parents("div.modal");if(!i.length)return;let s=i.data("overlay"),a=s.ref_target;t("a.addreference",e).each((function(){new n(t(this),a,s)})),t("a.removereference",e).each((function(){new o(t(this),a)}))}constructor(e){this.target=e,this.target_tag=e.get(0).tagName}single_value(){return"INPUT"==this.target_tag}multi_value(){return"SELECT"==this.target_tag.tagName}toggle_enabled(e){t("a",e.parent()).toggleClass("disabled")}reset_selected(e){let i=new Array;this.single_value()&&i.push(e.attr("value")),this.multi_value()&&t("[selected=selected]",e).each((function(){i.push(t(this).attr("value"))})),this.set_selected_on_ajax_target(e.parent(),i);let s=this.overlay().getOverlay(),a=this;t("div.referencebrowser a",s.elem).each((function(){let e=t(this);e.attr("ajax:target")&&a.set_selected_on_ajax_target(e,i)}))}set_selected_on_ajax_target(e,t){let s=i.ajax.parsetarget(e.attr("ajax:target"));s.params.selected=t.join(",");let a=new Array;for(let e in s.params)a.push(e+"="+s.params[e]);e.attr("ajax:target",s.url+"?"+a.join("&"))}}class n extends c{constructor(e,t,i){super(t),this.elem=e,this.overlay=i,e.off("click").on("click",this.add_reference.bind(this))}add_reference(e){e.preventDefault();let i=this.elem,s=this.target,a=i.attr("id");a=a.substring(4,a.length);let r=t(".reftitle",i.parent()).html();if(this.single_value()){s.attr("value",r);let e='[name="'+s.attr("name")+'.uid"]';return t(e).attr("value",a),this.set_selected_on_ajax_target(s.parent(),[a]),void this.overlay.close()}if(this.multi_value()){if(t('[value="'+a+'"]',s.parent()).length)return;let e=t("<option></option>");e.val(a).html(r).attr("selected","selected"),s.append(e)}this.reset_selected(s),this.toggle_enabled(i)}}class o extends c{constructor(e,t){super(t),this.elem=e,e.off("click").on("click",this.remove_reference.bind(this))}remove_reference(e){e.preventDefault();let i=this.elem,s=this.target,a=i.attr("id");if(a=a.substring(4,a.length),this.single_value()){s.attr("value","");let e='[name="'+s.attr("name")+'.uid"]';t(e).attr("value","")}if(this.multi_value()){let e='[value="'+a+'"]';if(!t(e,s.parent()).length)return;t(e,s).remove()}this.reset_selected(s),this.toggle_enabled(i)}}class h{static initialize(e){t(".referencebrowser_trigger",e).each((function(){new h(t(this))}))}constructor(e){this.wrapper=e.parent();let i=`[name="${e.data("reference-name")}"]`;this.target=t(i,this.wrapper),e.off("click").on("click",this.load_ref_browser.bind(this))}load_ref_browser(e){e.preventDefault(),i.ajax.overlay({action:"referencebrowser",target:this.wrapper.attr("ajax:target"),on_complete:this.on_complete.bind(this)}).ref_target=this.target}on_complete(e){let i=this.target;t("a.addreference",e.elem).each((function(){new n(t(this),i,e)})),t("a.removereference",e.elem).each((function(){new o(t(this),i)}))}}class d{static initialize(e){new d(e)}constructor(e){this.tabs=t("ul.settingstabs a",e),this.tabs.on("click",this.load_tab).first().trigger("click")}load_tab(e){e.preventDefault();let s=t(this),a=i.ajax.parsetarget(s.attr("ajax:target"));i.ajax.request({url:a.url,params:a.params,success:function(e,i,a){let r=t(s).parent().parent();t("li",r).removeClass("active"),s.parent().addClass("active"),t(".settingstabpane").html(e).css("display","block").tsajax()}})}}class _{static initialize(e){new _(e)}constructor(e){t("input.add_remove_role_for_principal",e).off("change").on("change",this.set_principal_role)}set_principal_role(e){e.preventDefault();let s,a=t(this);s=this.checked?"add_principal_role":"remove_principal_role";let r=a.parent().attr("ajax:target"),l={id:a.attr("name"),role:a.attr("value")};i.ajax.action({name:s,mode:"NONE",selector:"NONE",url:r,params:l})}}class p extends s{static initialize(e){new p(e,".table_length select",".table_filter input","term")}constructor(e,t,i,s){super(e,t,i,s)}}class u{constructor(e){this.options=e,this.selected=[],this.select_direction=0,this.firstclick=!0}reset(){this.selected=[]}add(e){this.remove(e),this.selected.push(e)}remove(e){let i=t.grep(this.selected,(function(t,i){return t!==e}));this.selected=i}select_no_key(e,t){e.children().removeClass("selected"),t.addClass("selected"),this.reset(),this.add(t.get(0))}select_ctrl_down(e){e.toggleClass("selected"),e.hasClass("selected")?this.add(e.get(0)):this.remove(e.get(0))}get_nearest(e,i){let s,a,r=e.children(".selected"),l=-1;return t(r).each((function(){a=t(this),s=a.index(),-1==l?l=s:i>s?this.select_direction>0?s<l&&(l=s):s>l&&(l=s):i<s&&s<l&&(l=s)})),l}select_shift_down(e,t){let i=t.index(),s=this.get_nearest(e,i);if(-1==s)t.addClass("selected"),this.add(t.get(0));else{let t,a;e.children().removeClass("selected"),i<s?(this.select_direction=-1,t=i,a=s):(this.select_direction=1,t=s,a=i),this.reset();let r=this;e.children().slice(t,a+1).addClass("selected").each((function(){r.add(this)}))}}handle_click(e){e.preventDefault();let i=t(e.currentTarget),s=i.parent();r.ctrl_down||r.shift_down?r.ctrl_down?this.select_ctrl_down(i):r.shift_down&&this.select_shift_down(s,i):this.select_no_key(s,i),this.firstclick&&(this.firstclick=!1,this.notify("on_firstclick",this,i)),this.notify("on_select",this)}notify(e,...t){this.options&&this.options[e]&&this.options[e](...t)}bind(e){e.off("click").on("click",this.handle_click.bind(this))}}t.fn.selectable=function(e){var t=new u(e);return t.bind(this),this.data("selectable",t),this},t((function(){new l,i.ajax.register(s.initialize,!0),i.ajax.register(a.initialize,!0),i.ajax.register(h.initialize,!0),i.ajax.register(c.initialize,!0),i.ajax.register(d.initialize,!0),i.ajax.register(_.initialize,!0),i.ajax.register(p.initialize,!0)})),e.AddReferenceHandle=n,e.BatchedItems=s,e.CopySupport=a,e.KeyBinder=l,e.ReferenceBrowserLoader=h,e.ReferenceHandle=c,e.RemoveReferenceHandle=o,e.Selectable=u,e.SettingsTabs=d,e.Sharing=_,e.TableToolbar=p,e.keys=r,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.cone&&(window.cone={}),Object.assign(window.cone,e)}({},jQuery,treibstoff);
