var cone_app_protected=function(e,t,i){"use strict";class a{constructor(e,t){this.elem=e,this.name=t}set_filter(e){let t=this.elem,a=i.ajax.parse_target(t.attr("ajax:target")),s=t.attr("ajax:event");if(a.params[this.name]=e,t.attr("ajax:path")){let r=t.attr("ajax:path-event");r||(r=s),i.ajax.path({path:a.path+a.query+"&"+this.name+"="+e,event:r,target:a})}let r=s.split(":");i.ajax.trigger({name:r[0],selector:r[1],target:a})}}class s extends a{static initialize(e,i=".batched_items_slice_size select"){t(i,e).each((function(){new s(t(this))}))}constructor(e){super(e,"size"),e.off("change").on("change",this.change_handle.bind(this))}change_handle(e){let i=t("option:selected",this.elem).first();this.set_filter(i.val())}}class r extends a{static initialize(e,i=".batched_items_filter input",a="term"){t(i,e).each((function(){new r(t(this),a)}))}constructor(e,t){super(e,t),e.off("focus").on("focus",this.focus_handle.bind(this)),e.off("keypress").on("keypress",this.keypress_handle.bind(this)),e.off("keyup").on("keyup",this.keyup_handle.bind(this)),e.off("change").on("change",this.change_handle.bind(this))}focus_handle(e){let t=this.elem;t.hasClass("empty_filter")&&(t.val(""),t.removeClass("empty_filter"))}keypress_handle(e){13==e.keyCode&&e.preventDefault()}keyup_handle(e){13==e.keyCode&&(e.preventDefault(),this.set_filter(this.elem.attr("value")))}change_handle(e){e.preventDefault(),this.set_filter(this.elem.attr("value"))}}class n{static initialize(e){new n(e)}constructor(e){this.cut_cookie="cone.app.copysupport.cut",this.copy_cookie="cone.app.copysupport.copy",this.context=e,this.paste_action=t("a#toolbaraction-paste",e),this.paste_action.off("click").on("click",this.handle_paste.bind(this)),this.copyable=t("table tr.selectable.copysupportitem",e),this.copyable.length&&(this.cut_action=t("a#toolbaraction-cut",e),this.cut_action.off("click").on("click",this.handle_cut.bind(this)),this.copy_action=t("a#toolbaraction-copy",e),this.copy_action.off("click").on("click",this.handle_copy.bind(this)),this.selectable=this.copyable.selectable({on_firstclick:this.on_firstclick.bind(this),on_select:this.on_select.bind(this)}).data("selectable"),this.read_selected_from_cookie(this.cut_cookie,"copysupport_cut"),this.read_selected_from_cookie(this.copy_cookie,""))}on_firstclick(e,t){}on_select(e){}write_selected_to_cookie(e){let a=t(this.selectable.selected),s=new Array;a.each((function(){s.push(t(this).attr("ajax:target"))}));let r=s.join("::");i.create_cookie(e,r),r.length?t(this.paste_action).removeClass("disabled"):t(this.paste_action).addClass("disabled")}read_selected_from_cookie(e,a){let s=i.read_cookie(e);if(!s)return;let r,n,l=s.split("::"),c=this;t("table tr.selectable",this.context).each((function(){r=t(this),n=r.attr("ajax:target");for(let e in l)if(l[e]==n){r.addClass("selected"),a&&r.addClass(a),c.selectable.add(r.get(0));break}}))}handle_cut(e){e.preventDefault(),i.create_cookie(this.copy_cookie,"",0),this.write_selected_to_cookie(this.cut_cookie),this.copyable.removeClass("copysupport_cut"),t(this.selectable.selected).addClass("copysupport_cut")}handle_copy(e){e.preventDefault(),i.create_cookie(this.cut_cookie,"",0),this.write_selected_to_cookie(this.copy_cookie),this.copyable.removeClass("copysupport_cut")}handle_paste(e){e.preventDefault();let a=t(e.currentTarget);if(a.hasClass("disabled"))return;let s=i.ajax.parse_target(a.attr("ajax:target"));i.ajax.action({name:"paste",mode:"NONE",selector:"NONE",url:s.url,params:s.params})}}let l={shift_down:!1,ctrl_down:!1};class c{constructor(){t(window).on("keydown",this.key_down.bind(this)),t(window).on("keyup",this.key_up.bind(this))}key_down(e){switch(e.keyCode||e.which){case 16:l.shift_down=!0;break;case 17:l.ctrl_down=!0}}key_up(e){switch(e.keyCode||e.which){case 16:l.shift_down=!1;break;case 17:l.ctrl_down=!1}}}class o{static initialize(e){if(!e)return;let i=e.parents("div.modal");if(!i.length)return;let a=i.data("overlay"),s=a.ref_target;t("a.addreference",e).each((function(){new h(t(this),s,a)})),t("a.removereference",e).each((function(){new d(t(this),s,a)}))}constructor(e,t,i){this.elem=e,this.target=t,this.target_tag=t.get(0).tagName,this.overlay=i}single_value(){return"INPUT"==this.target_tag}multi_value(){return"SELECT"==this.target_tag}toggle_enabled(e){t("a",e.parent()).toggleClass("disabled")}reset_selected(e){let i=new Array;this.single_value()&&i.push(e.attr("value")),this.multi_value()&&t("[selected=selected]",e).each((function(){i.push(t(this).attr("value"))})),this.set_selected_on_ajax_target(e.parent(),i);let a=this.overlay,s=this;t("div.referencebrowser a",a.elem).each((function(){let e=t(this);e.attr("ajax:target")&&s.set_selected_on_ajax_target(e,i)}))}set_selected_on_ajax_target(e,t){let a=i.ajax.parse_target(e.attr("ajax:target"));a.params.selected=t.join(",");let s=new Array;for(let e in a.params)s.push(e+"="+a.params[e]);e.attr("ajax:target",a.url+"?"+s.join("&"))}}class h extends o{constructor(e,t,i){super(e,t,i),e.off("click").on("click",this.add_reference.bind(this))}add_reference(e){e.preventDefault();let i=this.elem,a=this.target,s=i.attr("id");s=s.substring(4,s.length);let r=t(".reftitle",i.parent()).html();if(this.single_value()){a.attr("value",r);let e='[name="'+a.attr("name")+'.uid"]';return t(e).attr("value",s),this.set_selected_on_ajax_target(a.parent(),[s]),void this.overlay.close()}if(this.multi_value()){if(t('[value="'+s+'"]',a.parent()).length)return;let e=t("<option></option>");e.val(s).html(r).attr("selected","selected"),a.append(e),a.trigger("change")}this.reset_selected(a),this.toggle_enabled(i)}}class d extends o{constructor(e,t,i){super(e,t,i),e.off("click").on("click",this.remove_reference.bind(this))}remove_reference(e){e.preventDefault();let i=this.elem,a=this.target,s=i.attr("id");if(s=s.substring(4,s.length),this.single_value()){a.attr("value","");let e='[name="'+a.attr("name")+'.uid"]';t(e).attr("value","")}if(this.multi_value()){let e='[value="'+s+'"]';if(!t(e,a.parent()).length)return;t(e,a).remove(),a.trigger("change")}this.reset_selected(a),this.toggle_enabled(i)}}class _{static initialize(e){t(".referencebrowser_trigger",e).each((function(){new _(t(this))}))}constructor(e){this.wrapper=e.parent();let i=`[name="${e.data("reference-name")}"]`;this.target=t(i,this.wrapper),e.off("click").on("click",this.load_ref_browser.bind(this))}load_ref_browser(e){e.preventDefault(),i.ajax.overlay({action:"referencebrowser",target:this.wrapper.attr("ajax:target"),on_complete:this.on_complete.bind(this)}).ref_target=this.target}on_complete(e){let i=this.target;t("a.addreference",e.elem).each((function(){new h(t(this),i,e)})),t("a.removereference",e.elem).each((function(){new d(t(this),i,e)}))}}function p(e,t){_.initialize(t)}function f(e,i,a){t(".referencebrowser_trigger",i).each((function(){let i=t(this),s=i.data("reference-name"),r=e.base_id.replace(/\-/g,".");i.data("reference-name",e.set_value_index(s,r,a,"."))}))}t((function(){void 0!==window.yafowil_array&&(yafowil_array.on_array_event("on_add",p),yafowil_array.on_array_event("on_index",f))}));class u{static initialize(e){new u(e)}constructor(e){this.tabs=t("ul.settingstabs a",e),this.tabs.on("click",this.load_tab).first().trigger("click")}load_tab(e){e.preventDefault();let a=t(this),s=i.ajax.parse_target(a.attr("ajax:target"));i.ajax.request({url:s.url,params:s.params,success:function(e,i,s){let r=t(a).parent().parent();t("li",r).removeClass("active"),a.parent().addClass("active"),t(".settingstabpane").html(e).css("display","block").tsajax()}})}}class g{static initialize(e){new g(e)}constructor(e){t("input.add_remove_role_for_principal",e).off("change").on("change",this.set_principal_role)}set_principal_role(e){e.preventDefault();let a,s=t(this);a=this.checked?"add_principal_role":"remove_principal_role";let r=s.parent().attr("ajax:target"),n={id:s.attr("name"),role:s.attr("value")};i.ajax.action({name:a,mode:"NONE",selector:"NONE",url:r,params:n})}}class m{static initialize(e){s.initialize(e,".table_length select"),r.initialize(e,".table_filter input")}}class b{static initialize(e){t(".translation-nav",e).each((function(){new b(t(this))}))}constructor(e){this.nav_elem=e,this.fields_elem=e.next(),this.show_lang_handle=this.show_lang_handle.bind(this),t("li > a",e).on("click",this.show_lang_handle),t("li.error",e).length?t("li.error:first > a",e).click():t("li.active > a",e).click(),this.fields_elem.show()}show_lang_handle(e){e.preventDefault(),this.nav_elem.children().removeClass("active"),this.fields_elem.children().hide();let i=t(e.currentTarget);i.parent().addClass("active"),t(i.attr("href"),this.fields_elem).show()}}class k{constructor(e){this.options=e,this.selected=[],this.select_direction=0,this.firstclick=!0}reset(){this.selected=[]}add(e){this.remove(e),this.selected.push(e)}remove(e){let i=t.grep(this.selected,(function(t,i){return t!==e}));this.selected=i}select_no_key(e,t){e.children().removeClass("selected"),t.addClass("selected"),this.reset(),this.add(t.get(0))}select_ctrl_down(e){e.toggleClass("selected"),e.hasClass("selected")?this.add(e.get(0)):this.remove(e.get(0))}get_nearest(e,i){let a,s,r=e.children(".selected"),n=-1;return t(r).each((function(){s=t(this),a=s.index(),-1==n?n=a:i>a?this.select_direction>0?a<n&&(n=a):a>n&&(n=a):i<a&&a<n&&(n=a)})),n}select_shift_down(e,t){let i=t.index(),a=this.get_nearest(e,i);if(-1==a)t.addClass("selected"),this.add(t.get(0));else{let t,s;e.children().removeClass("selected"),i<a?(this.select_direction=-1,t=i,s=a):(this.select_direction=1,t=a,s=i),this.reset();let r=this;e.children().slice(t,s+1).addClass("selected").each((function(){r.add(this)}))}}handle_click(e){e.preventDefault();let i=t(e.currentTarget),a=i.parent();l.ctrl_down||l.shift_down?l.ctrl_down?this.select_ctrl_down(i):l.shift_down&&this.select_shift_down(a,i):this.select_no_key(a,i),this.firstclick&&(this.firstclick=!1,this.notify("on_firstclick",this,i)),this.notify("on_select",this)}notify(e,...t){this.options&&this.options[e]&&this.options[e](...t)}bind(e){e.off("click").on("click",this.handle_click.bind(this))}}function v(e,t,a){i.deprecate("createCookie","ts.create_cookie","1.1"),i.create_cookie(e,t,a)}function w(e){return i.deprecate("readCookie","ts.read_cookie","1.1"),i.read_cookie(e)}return t.fn.selectable=function(e){var t=new k(e);return t.bind(this),this.data("selectable",t),this},t((function(){new c,i.ajax.register(s.initialize,!0),i.ajax.register(r.initialize,!0),i.ajax.register(n.initialize,!0),i.ajax.register(_.initialize,!0),i.ajax.register(o.initialize,!0),i.ajax.register(u.initialize,!0),i.ajax.register(g.initialize,!0),i.ajax.register(m.initialize,!0),i.ajax.register(b.initialize,!0)})),e.AddReferenceHandle=h,e.BatchedItemsFilter=a,e.BatchedItemsSearch=r,e.BatchedItemsSize=s,e.CopySupport=n,e.KeyBinder=c,e.ReferenceBrowserLoader=_,e.ReferenceHandle=o,e.RemoveReferenceHandle=d,e.Selectable=k,e.SettingsTabs=u,e.Sharing=g,e.TableToolbar=m,e.Translation=b,e.batcheditems_filter_binder=function(e,t,a){i.deprecate("batcheditems_filter_binder","BatchedItems.bind_search","1.1"),t||(t=".batched_items_filter input"),a||(a="term"),r.initialize(e,t,a)},e.batcheditems_handle_filter=function(e,t,s){i.deprecate("batcheditems_handle_filter","BatchedItems.set_filter","1.1"),new a(e,t).set_filter(s)},e.batcheditems_size_binder=function(e,t){i.deprecate("batcheditems_size_binder","BatchedItems.bind_size","1.1"),t||(t=".batched_items_slice_size select"),s.initialize(e,t)},e.createCookie=v,e.keys=l,e.readCookie=w,Object.defineProperty(e,"__esModule",{value:!0}),window.cone=window.cone||{},Object.assign(window.cone,e),window.createCookie=v,window.readCookie=w,e}({},jQuery,treibstoff);
