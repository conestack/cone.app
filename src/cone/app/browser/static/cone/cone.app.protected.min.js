var cone_app_protected=function(e,t,i){"use strict";class s{constructor(e,t){this.elem=e,this.name=t}set_filter(e){let t=this.elem,s=i.ajax.parse_target(t.attr("ajax:target")),a=t.attr("ajax:event");if(s.params[this.name]=e,t.attr("ajax:path")){let o=t.attr("ajax:path-event");o||(o=a),i.ajax.path({path:s.path+s.query+"&"+this.name+"="+e,event:o,target:s})}let o=a.split(":");i.ajax.trigger({name:o[0],selector:o[1],target:s})}}class a extends s{static initialize(e,i=".batched_items_slice_size select"){t(i,e).each((function(){new a(t(this))}))}constructor(e){super(e,"size"),e.off("change").on("change",this.change_handle.bind(this))}change_handle(e){let i=t("option:selected",this.elem).first();this.set_filter(i.val())}}class o extends s{static initialize(e,i=".batched_items_filter input",s="term"){t(i,e).each((function(){new o(t(this),s)}))}constructor(e,t){super(e,t),e.off("focus").on("focus",this.focus_handle.bind(this)),e.off("keypress").on("keypress",this.keypress_handle.bind(this)),e.off("keyup").on("keyup",this.keyup_handle.bind(this)),e.off("change").on("change",this.change_handle.bind(this))}focus_handle(e){let t=this.elem;t.hasClass("empty_filter")&&(t.val(""),t.removeClass("empty_filter"))}keypress_handle(e){13==e.keyCode&&e.preventDefault()}keyup_handle(e){13==e.keyCode&&(e.preventDefault(),this.set_filter(this.elem.val()))}change_handle(e){e.preventDefault(),this.set_filter(this.elem.val())}}class r{static initialize(e){new r(e)}constructor(e){this.cut_cookie="cone.app.copysupport.cut",this.copy_cookie="cone.app.copysupport.copy",this.context=e,this.paste_action=t("a#toolbaraction-paste",e),this.paste_action.off("click").on("click",this.handle_paste.bind(this)),this.copyable=t("table tr.selectable.copysupportitem",e),this.copyable.length&&(this.cut_action=t("a#toolbaraction-cut",e),this.cut_action.off("click").on("click",this.handle_cut.bind(this)),this.copy_action=t("a#toolbaraction-copy",e),this.copy_action.off("click").on("click",this.handle_copy.bind(this)),this.selectable=this.copyable.selectable({on_firstclick:this.on_firstclick.bind(this),on_select:this.on_select.bind(this)}).data("selectable"),this.read_selected_from_cookie(this.cut_cookie,"copysupport_cut"),this.read_selected_from_cookie(this.copy_cookie,""))}on_firstclick(e,t){}on_select(e){}write_selected_to_cookie(e){let s=t(this.selectable.selected),a=new Array;s.each((function(){a.push(t(this).attr("ajax:target"))}));let o=a.join("::");i.create_cookie(e,o),o.length?t(this.paste_action).removeClass("disabled"):t(this.paste_action).addClass("disabled")}read_selected_from_cookie(e,s){let a=i.read_cookie(e);if(!a)return;let o,r,n=a.split("::"),l=this;t("table tr.selectable",this.context).each((function(){o=t(this),r=o.attr("ajax:target");for(let e in n)if(n[e]==r){o.addClass("selected"),s&&o.addClass(s),l.selectable.add(o.get(0));break}}))}handle_cut(e){e.preventDefault(),i.create_cookie(this.copy_cookie,"",0),this.write_selected_to_cookie(this.cut_cookie),this.copyable.removeClass("copysupport_cut"),t(this.selectable.selected).addClass("copysupport_cut")}handle_copy(e){e.preventDefault(),i.create_cookie(this.cut_cookie,"",0),this.write_selected_to_cookie(this.copy_cookie),this.copyable.removeClass("copysupport_cut")}handle_paste(e){e.preventDefault();let s=t(e.currentTarget);if(s.hasClass("disabled"))return;let a=i.ajax.parse_target(s.attr("ajax:target"));i.ajax.action({name:"paste",mode:"NONE",selector:"NONE",url:a.url,params:a.params})}}let n={shift_down:!1,ctrl_down:!1};class l{constructor(){t(window).on("keydown",this.key_down.bind(this)),t(window).on("keyup",this.key_up.bind(this))}key_down(e){switch(e.keyCode||e.which){case 16:n.shift_down=!0;break;case 17:n.ctrl_down=!0}}key_up(e){switch(e.keyCode||e.which){case 16:n.shift_down=!1;break;case 17:n.ctrl_down=!1}}}class h{static initialize(e){if(!e)return;let i=e.parents("div.modal");if(!i.length)return;let s=i.data("overlay"),a=s.ref_target;t("a.addreference",e).each((function(){new c(t(this),a,s)})),t("a.removereference",e).each((function(){new d(t(this),a,s)}))}constructor(e,t,i){this.elem=e,this.target=t,this.target_tag=t.get(0).tagName,this.overlay=i}single_value(){return"INPUT"==this.target_tag}multi_value(){return"SELECT"==this.target_tag}toggle_enabled(e){t("a",e.parent()).toggleClass("disabled")}reset_selected(e){let i=new Array;this.single_value()&&i.push(e.attr("value")),this.multi_value()&&t("[selected=selected]",e).each((function(){i.push(t(this).attr("value"))})),this.set_selected_on_ajax_target(e.parent(),i);let s=this.overlay,a=this;t("div.referencebrowser a",s.elem).each((function(){let e=t(this);e.attr("ajax:target")&&a.set_selected_on_ajax_target(e,i)}))}set_selected_on_ajax_target(e,t){let s=i.ajax.parse_target(e.attr("ajax:target"));s.params.selected=t.join(",");let a=new Array;for(let e in s.params)a.push(e+"="+s.params[e]);e.attr("ajax:target",s.url+"?"+a.join("&"))}}class c extends h{constructor(e,t,i){super(e,t,i),e.off("click").on("click",this.add_reference.bind(this))}add_reference(e){e.preventDefault();let i=this.elem,s=this.target,a=i.attr("id");a=a.substring(4,a.length);let o=t(".reftitle",i.parent()).html();if(this.single_value()){s.attr("value",o);let e='[name="'+s.attr("name")+'.uid"]';return t(e).attr("value",a),this.set_selected_on_ajax_target(s.parent(),[a]),void this.overlay.close()}if(this.multi_value()){if(t('[value="'+a+'"]',s.parent()).length)return;let e=t("<option></option>");e.val(a).html(o).attr("selected","selected"),s.append(e),s.trigger("change")}this.reset_selected(s),this.toggle_enabled(i)}}class d extends h{constructor(e,t,i){super(e,t,i),e.off("click").on("click",this.remove_reference.bind(this))}remove_reference(e){e.preventDefault();let i=this.elem,s=this.target,a=i.attr("id");if(a=a.substring(4,a.length),this.single_value()){s.attr("value","");let e='[name="'+s.attr("name")+'.uid"]';t(e).attr("value","")}if(this.multi_value()){let e='[value="'+a+'"]';if(!t(e,s.parent()).length)return;t(e,s).remove(),s.trigger("change")}this.reset_selected(s),this.toggle_enabled(i)}}class _{static initialize(e){t(".referencebrowser_trigger",e).each((function(){new _(t(this))}))}constructor(e){this.wrapper=e.parent();let i=`[name="${e.data("reference-name")}"]`;this.target=t(i,this.wrapper),e.off("click").on("click",this.load_ref_browser.bind(this))}load_ref_browser(e){e.preventDefault(),i.ajax.overlay({action:"referencebrowser",target:this.wrapper.attr("ajax:target"),on_complete:this.on_complete.bind(this)}).ref_target=this.target}on_complete(e){let i=this.target;t("a.addreference",e.elem).each((function(){new c(t(this),i,e)})),t("a.removereference",e.elem).each((function(){new d(t(this),i,e)}))}}function u(e,t){_.initialize(t)}function p(e,i,s){t(".referencebrowser_trigger",i).each((function(){let i=t(this),a=i.data("reference-name"),o=e.base_id.replace(/\-/g,".");i.data("reference-name",e.set_value_index(a,o,s,"."))}))}t((function(){void 0!==window.yafowil_array&&(yafowil_array.on_array_event("on_add",u),yafowil_array.on_array_event("on_index",p))}));class m{static initialize(e){new m(e)}constructor(e){t("input.add_remove_role_for_principal",e).off("change").on("change",this.set_principal_role)}set_principal_role(e){e.preventDefault();let s,a=t(this);s=this.checked?"add_principal_role":"remove_principal_role";let o=a.parent().attr("ajax:target"),r={id:a.attr("name"),role:a.attr("value")};i.ajax.action({name:s,mode:"NONE",selector:"NONE",url:o,params:r})}}class f{static initialize(e){a.initialize(e,".table_length select"),o.initialize(e,".table_filter input")}}class g{static initialize(e){t(".translation-nav",e).each((function(){new g(t(this))}))}constructor(e){this.nav_elem=e,this.fields_elem=e.next(),this.show_lang_handle=this.show_lang_handle.bind(this),t("li > a",e).on("click",this.show_lang_handle),t("li.error",e).length?t("li.error:first > a",e).click():t("li.active > a",e).click(),this.fields_elem.show()}show_lang_handle(e){e.preventDefault(),this.nav_elem.children().removeClass("active"),this.fields_elem.children().hide();let i=t(e.currentTarget);i.parent().addClass("active"),t(i.attr("href"),this.fields_elem).show()}}class b{static initialize(e){new b(e)}constructor(e){this.elem=$("#colortoggle-switch",e),this.compile(),this.set_theme(this.preferred_theme),this.elem.on("change",(e=>{this.elem.is(":checked")?this.set_theme("dark"):this.set_theme("light")}))}get stored_theme(){return localStorage.getItem("bootstrap-theme")||null}get preferred_theme(){return this.stored_theme?this.stored_theme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}compile(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{"light"===this.stored_theme&&"dark"===this.stored_theme||this.set_theme(this.preferred_theme)}))}set_theme(e){"auto"===e&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.setAttribute("data-bs-theme","dark"),this.elem.trigger("click")):document.documentElement.setAttribute("data-bs-theme",e),localStorage.setItem("bootstrap-theme",e),"dark"!==e||this.elem.is(":checked")||this.elem.trigger("click")}}class v extends i.Events{static initialize(e){t(".scrollable-x",e).each((function(){new w(t(this))})),t(".scrollable-y",e).each((function(){new k(t(this))}))}constructor(e){super(),this.elem=e,this.elem.data("scrollbar",this),this.content=t(".scrollable-content",this.elem),this.position=0,this.unit=50,this.compile(),this.on_scroll=this.on_scroll.bind(this),this.elem.on("mousewheel wheel",this.on_scroll),this.on_click=this.on_click.bind(this),this.scrollbar.on("click",this.on_click),this.on_drag=this.on_drag.bind(this),this.thumb.on("mousedown",this.on_drag),this.on_hover=this.on_hover.bind(this),this.elem.on("mouseenter mouseleave",this.on_hover),this.on_resize=this.on_resize.bind(this),t(window).on("resize",this.on_resize),i.ajax.attach(this,this.elem),this.update()}destroy(){t(window).off("resize",this.on_resize)}compile(){i.compile_template(this,'\n        <div class="scrollbar" t-elem="scrollbar">\n          <div class="scroll-handle" t-elem="thumb">\n          </div>\n        </div>\n        ',this.elem)}update(){throw"Abstract Scrollbar does not implement update()"}unload(){this.scrollbar.off("click",this.on_click),this.elem.off("mousewheel wheel",this.on_scroll),this.elem.off("mouseenter mouseleave",this.on_hover),this.thumb.off("mousedown",this.on_drag)}on_hover(e){e.preventDefault(),e.stopPropagation();const i=this.elem.get(0);(t(i).has(e.target).length>0||t(i).is(e.target))&&this.contentsize>this.scrollsize&&("mouseenter"===e.type?this.scrollbar.fadeIn():"mouseleave"===e.type&&e.relatedTarget!==this.elem.get(0)&&this.scrollbar.fadeOut())}on_scroll(e){if(this.contentsize<=this.scrollsize)return;let t=e.originalEvent;"number"==typeof t.deltaY&&(t.deltaY>0?this.position+=this.unit:t.deltaY<0&&(this.position-=this.unit)),this.set_position()}prevent_overflow(){let e=this.contentsize-this.scrollsize;this.position>=e?this.position=e:this.position<=0&&(this.position=0)}on_click(e){e.preventDefault(),this.thumb.addClass("active");let t=this.get_evt_data(e)-this.offset-this.thumbsize/2;this.position=this.contentsize*t/this.scrollsize,this.set_position(),this.thumb.removeClass("active")}on_drag(e){e.preventDefault();var i=t.Event("dragstart");t(window).trigger(i);let s=function(e){let t=this.get_evt_data(e)-this.offset,i=r+t-o;this.position=this.contentsize*i/this.scrollsize,this.set_position()}.bind(this),a=function(){var e=t.Event("dragend");t(window).trigger(e),t(document).off("mousemove",s).off("mouseup",a),this.thumb.removeClass("active"),this.elem.on("mouseenter mouseleave",this.on_hover)}.bind(this),o=this.get_evt_data(e)-this.offset,r=this.position/(this.contentsize/this.scrollsize);this.thumb.addClass("active"),this.elem.off("mouseenter mouseleave",this.on_hover),t(document).on("mousemove",s).on("mouseup",a)}}class w extends v{constructor(e){super(e)}get offset(){return this.elem.offset().left}compile(){super.compile(),this.thumb.css("height","6px"),this.scrollbar.css("height","6px"),this.scrollsize=this.elem.outerWidth(),this.contentsize=this.content.outerWidth(),this.scrollbar.css("width",this.scrollsize),this.thumbsize=this.scrollsize/(this.contentsize/this.scrollsize),this.thumb.css("width",this.thumbsize)}update(){this.scrollsize=this.elem.outerWidth(),this.scrollbar.css("width",this.scrollsize),this.content.outerWidth()!==this.contentsize&&(this.contentsize=this.content.outerWidth()),this.contentsize<=this.scrollsize?this.thumbsize=this.scrollsize:this.thumbsize=Math.pow(this.scrollsize,2)/this.contentsize,this.thumb.css("width",this.thumbsize),this.set_position()}on_resize(){this.update()}set_position(){this.prevent_overflow();let e=this.position/(this.contentsize/this.scrollsize);this.content.css("right",this.position+"px"),this.thumb.css("left",e+"px"),this.trigger("on_position")}get_evt_data(e){return e.pageX}}class k extends v{constructor(e){super(e)}get offset(){return this.elem.offset().top}compile(){super.compile(),this.thumb.css("width","6px"),this.scrollbar.css("width","6px"),this.scrollbar.css("top","0px"),this.scrollsize=this.elem.outerHeight(),this.contentsize=this.content.outerHeight(),this.scrollbar.css("height",this.scrollsize),this.thumbsize=this.scrollsize/(this.contentsize/this.scrollsize),this.thumb.css("height",this.thumbsize)}update(){this.scrollsize=this.elem.outerHeight(),this.scrollbar.css("height",this.scrollsize),this.content.outerHeight()!==this.contentsize&&(this.contentsize=this.content.outerHeight()),this.contentsize<=this.scrollsize?this.thumbsize=this.scrollsize:this.thumbsize=Math.pow(this.scrollsize,2)/this.contentsize,this.thumb.css("height",this.thumbsize),this.set_position()}on_resize(){this.update()}set_position(){this.prevent_overflow();let e=this.position/(this.contentsize/this.scrollsize);this.content.css("bottom",this.position+"px"),this.thumb.css("top",e+"px"),this.trigger("on_position")}get_evt_data(e){return e.pageY}}class z{constructor(e){this.options=e,this.selected=[],this.select_direction=0,this.firstclick=!0}reset(){this.selected=[]}add(e){this.remove(e),this.selected.push(e)}remove(e){let i=t.grep(this.selected,(function(t,i){return t!==e}));this.selected=i}select_no_key(e,t){e.children().removeClass("selected"),t.addClass("selected"),this.reset(),this.add(t.get(0))}select_ctrl_down(e){e.toggleClass("selected"),e.hasClass("selected")?this.add(e.get(0)):this.remove(e.get(0))}get_nearest(e,i){let s,a,o=e.children(".selected"),r=-1;return t(o).each((function(){a=t(this),s=a.index(),-1==r?r=s:i>s?this.select_direction>0?s<r&&(r=s):s>r&&(r=s):i<s&&s<r&&(r=s)})),r}select_shift_down(e,t){let i=t.index(),s=this.get_nearest(e,i);if(-1==s)t.addClass("selected"),this.add(t.get(0));else{let t,a;e.children().removeClass("selected"),i<s?(this.select_direction=-1,t=i,a=s):(this.select_direction=1,t=s,a=i),this.reset();let o=this;e.children().slice(t,a+1).addClass("selected").each((function(){o.add(this)}))}}handle_click(e){e.preventDefault();let i=t(e.currentTarget),s=i.parent();n.ctrl_down||n.shift_down?n.ctrl_down?this.select_ctrl_down(i):n.shift_down&&this.select_shift_down(s,i):this.select_no_key(s,i),this.firstclick&&(this.firstclick=!1,this.notify("on_firstclick",this,i)),this.notify("on_select",this)}notify(e,...t){this.options&&this.options[e]&&this.options[e](...t)}bind(e){e.off("click").on("click",this.handle_click.bind(this))}}function y(e,t,s){i.deprecate("createCookie","ts.create_cookie","1.1"),i.create_cookie(e,t,s)}function x(e){return i.deprecate("readCookie","ts.read_cookie","1.1"),i.read_cookie(e)}return t.fn.selectable=function(e){var t=new z(e);return t.bind(this),this.data("selectable",t),this},t((function(){new l,i.ajax.register(a.initialize,!0),i.ajax.register(o.initialize,!0),i.ajax.register(r.initialize,!0),i.ajax.register(_.initialize,!0),i.ajax.register(h.initialize,!0),i.ajax.register(m.initialize,!0),i.ajax.register(f.initialize,!0),i.ajax.register(g.initialize,!0),i.ajax.register(b.initialize,!0),i.ajax.register(v.initialize,!0)})),e.AddReferenceHandle=c,e.BatchedItemsFilter=s,e.BatchedItemsSearch=o,e.BatchedItemsSize=a,e.Colormode=b,e.CopySupport=r,e.KeyBinder=l,e.ReferenceBrowserLoader=_,e.ReferenceHandle=h,e.RemoveReferenceHandle=d,e.Scrollbar=v,e.ScrollbarX=w,e.ScrollbarY=k,e.Selectable=z,e.Sharing=m,e.TableToolbar=f,e.Translation=g,e.batcheditems_filter_binder=function(e,t,s){i.deprecate("batcheditems_filter_binder","BatchedItems.bind_search","1.1"),t||(t=".batched_items_filter input"),s||(s="term"),o.initialize(e,t,s)},e.batcheditems_handle_filter=function(e,t,a){i.deprecate("batcheditems_handle_filter","BatchedItems.set_filter","1.1"),new s(e,t).set_filter(a)},e.batcheditems_size_binder=function(e,t){i.deprecate("batcheditems_size_binder","BatchedItems.bind_size","1.1"),t||(t=".batched_items_slice_size select"),a.initialize(e,t)},e.createCookie=y,e.keys=n,e.readCookie=x,Object.defineProperty(e,"__esModule",{value:!0}),window.cone=window.cone||{},Object.assign(window.cone,e),window.createCookie=y,window.readCookie=x,e}({},jQuery,treibstoff);
