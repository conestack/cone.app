var cone=function(e,t,s){"use strict";class i{constructor(e,t){this.elem=e,this.name=t}set_filter(e){let t=this.elem,i=s.ajax.parse_target(t.attr("ajax:target")),o=t.attr("ajax:event");if(i.params[this.name]=e,t.attr("ajax:path")){let r=t.attr("ajax:path-event");r||(r=o),s.ajax.path({path:i.path+i.query+"&"+this.name+"="+e,event:r,target:i})}let r=o.split(":");s.ajax.trigger({name:r[0],selector:r[1],target:i})}}class o extends i{static initialize(e,s=".batched_items_slice_size select"){t(s,e).each(function(){new o(t(this))})}constructor(e){super(e,"size"),e.off("change").on("change",this.change_handle.bind(this))}change_handle(e){let s=t("option:selected",this.elem).first();this.set_filter(s.val())}}class r extends i{static initialize(e,s=".batched_items_filter input",i="term"){t(s,e).each(function(){new r(t(this),i)})}constructor(e,t){super(e,t),e.off("focus").on("focus",this.focus_handle.bind(this)),e.off("keypress").on("keypress",this.keypress_handle.bind(this)),e.off("keyup").on("keyup",this.keyup_handle.bind(this)),e.off("change").on("change",this.change_handle.bind(this))}focus_handle(e){let t=this.elem;t.hasClass("empty_filter")&&(t.val(""),t.removeClass("empty_filter"))}keypress_handle(e){13==e.keyCode&&e.preventDefault()}keyup_handle(e){13==e.keyCode&&(e.preventDefault(),this.set_filter(this.elem.val()))}change_handle(e){e.preventDefault(),this.set_filter(this.elem.val())}}class n{static get media_query(){return window.matchMedia("(prefers-color-scheme: dark)")}static get stored_theme(){return localStorage.getItem("cone-app-color-theme")}static set stored_theme(e){localStorage.setItem("cone-app-color-theme",e)}static get preferred_theme(){return this.stored_theme?this.stored_theme:this.media_query.matches?"dark":"light"}static watch(e){this.media_query.addEventListener("change",e)}static set_theme(e){const t=document.documentElement;"auto"===e&&this.media_query.matches?t.setAttribute("data-bs-theme","dark"):t.setAttribute("data-bs-theme",e)}constructor(){n.bind(),n.set_theme(n.preferred_theme)}static bind(){this.boundCallback=this.callback.bind(this),this.watch(this.boundCallback)}static callback(){const e=this.stored_theme;"light"!==e&&"dark"!==e&&n.set_theme(n.preferred_theme)}static unbind(){this.boundCallback&&(this.media_query.removeEventListener("change",this.boundCallback),document.documentElement.removeAttribute("data-bs-theme"))}}class l extends s.ChangeListener{static initialize(e){const t=s.query_elem("#colortoggle-switch",e);t&&new l(t)}constructor(e){super({elem:e}),this.update=this.update.bind(this),this.update(),n.watch(this.update())}update(){const e=n.preferred_theme,t=this.elem,s=t.is(":checked");"dark"!==e||s?"light"===e&&s&&t.prop("checked",!1):t.prop("checked",!0)}on_change(){const e=this.elem.is(":checked")?"dark":"light";n.set_theme(e),n.stored_theme=e}}class a{static initialize(e){new a(e)}constructor(e){this.cut_cookie="cone.app.copysupport.cut",this.copy_cookie="cone.app.copysupport.copy",this.context=e,this.paste_action=t("a#toolbaraction-paste",e),this.paste_action.off("click").on("click",this.handle_paste.bind(this)),this.copyable=t("table tr.selectable.copysupportitem",e),this.copyable.length&&(this.cut_action=t("a#toolbaraction-cut",e),this.cut_action.off("click").on("click",this.handle_cut.bind(this)),this.copy_action=t("a#toolbaraction-copy",e),this.copy_action.off("click").on("click",this.handle_copy.bind(this)),this.selectable=this.copyable.selectable({on_firstclick:this.on_firstclick.bind(this),on_select:this.on_select.bind(this)}).data("selectable"),this.read_selected_from_cookie(this.cut_cookie,"copysupport_cut"),this.read_selected_from_cookie(this.copy_cookie,""))}on_firstclick(e,t){}on_select(e){}write_selected_to_cookie(e){let i=t(this.selectable.selected),o=new Array;i.each(function(){o.push(t(this).attr("ajax:target"))});let r=o.join("::");s.create_cookie(e,r),r.length?t(this.paste_action).removeClass("disabled"):t(this.paste_action).addClass("disabled")}read_selected_from_cookie(e,i){let o=s.read_cookie(e);if(!o)return;let r,n,l=o.split("::"),a=this;t("table tr.selectable",this.context).each(function(){r=t(this),n=r.attr("ajax:target");for(let e in l)if(l[e]==n){r.addClass("selected"),i&&r.addClass(i),a.selectable.add(r.get(0));break}})}handle_cut(e){e.preventDefault(),s.create_cookie(this.copy_cookie,"",0),this.write_selected_to_cookie(this.cut_cookie),this.copyable.removeClass("copysupport_cut"),t(this.selectable.selected).addClass("copysupport_cut")}handle_copy(e){e.preventDefault(),s.create_cookie(this.cut_cookie,"",0),this.write_selected_to_cookie(this.copy_cookie),this.copyable.removeClass("copysupport_cut")}handle_paste(e){e.preventDefault();let i=t(e.currentTarget);if(i.hasClass("disabled"))return;let o=s.ajax.parse_target(i.attr("ajax:target"));s.ajax.action({name:"paste",mode:"NONE",selector:"NONE",url:o.url,params:o.params})}}let h={shift_down:!1,ctrl_down:!1};class c{constructor(){t(window).on("keydown",this.key_down.bind(this)),t(window).on("keyup",this.key_up.bind(this))}key_down(e){switch(e.keyCode||e.which){case 16:h.shift_down=!0;break;case 17:h.ctrl_down=!0}}key_up(e){switch(e.keyCode||e.which){case 16:h.shift_down=!1;break;case 17:h.ctrl_down=!1}}}class d{static initialize(e,t=null){const i=s.query_elem("input#search-text",e);i&&(null===t&&(t=cone.LiveSearch),new t(i))}constructor(e){this.elem=e,this.target=`${e.data("search-target")}/livesearch`,this.content=t("#content"),this.result=null,this._term="",this._minlen=3,this._delay=250,this._timeout_event=null,this._in_progress=!1,this.on_keydown=this.on_keydown.bind(this),this.on_change=this.on_change.bind(this),this.on_result=this.on_result.bind(this),e.on("keydown",this.on_keydown),e.on("change",this.on_change)}search(){this._in_progress=!0,s.http_request({url:this.target,params:{term:this._term},type:"json",success:this.on_result}),this._in_progress=!1}render_no_results(){s.compile_template(this,'\n        <h5 class="card-title">No search results</h5>\n        ',this.result)}render_suggestion(e){s.compile_template(this,`\n        <div class="mb-4">\n          <h5 class="card-title">\n            <a href="${e.target}"\n               ajax:bind="click"\n               ajax:event="contextchanged:#layout"\n               ajax:target="${e.target}">\n              <i class="${e.icon}"></i>\n              ${e.value}\n            </a>\n          </h5>\n          <p class="card-text">\n            ${void 0===e.description?"":e.description}\n          </p>\n        </div>\n        `,this.result)}on_result(e,t,i){if(this.content.empty(),s.compile_template(this,`\n        <div class="card mt-2">\n          <div class="card-body" t-elem="result">\n            <h3 class="card-title mb-3">Search results for "${this._term}"</h3>\n          </div>\n        </div>\n        `,this.content),e.length){s.compile_template(this,`\n            <p class="card-text mb-3">\n              <span>${e.length} Results</span>\n            </p>\n            `,this.result);for(const t of e)this.render_suggestion(t)}else this.render_no_results();this.result.tsajax()}on_keydown(e){13!==e.keyCode&&s.clock.schedule_frame(()=>{this._term!==this.elem.val()&&this.elem.trigger("change")})}on_change(e){if(this._in_progress)return;const t=this.elem.val();this._term!==t&&(this._term=t,this._term.length<this._minlen||(null!==this._timeout_event&&this._timeout_event.cancel(),this._timeout_event=s.clock.schedule_timeout(()=>{this._timeout_event=null,this.search()},this._delay)))}}class _{static initialize(e){if(!e)return;let s=e.parents("div.modal");if(!s.length)return;let i=s.data("overlay"),o=i.ref_target;t("a.addreference",e).each(function(){new p(t(this),o,i)}),t("a.removereference",e).each(function(){new m(t(this),o,i)})}constructor(e,t,s){this.elem=e,this.target=t,this.target_tag=t.get(0).tagName,this.overlay=s}single_value(){return"INPUT"==this.target_tag}multi_value(){return"SELECT"==this.target_tag}toggle_enabled(e){t("a",e.parent()).toggleClass("disabled")}reset_selected(e){let s=new Array;this.single_value()&&s.push(e.attr("value")),this.multi_value()&&t("[selected=selected]",e).each(function(){s.push(t(this).attr("value"))}),this.set_selected_on_ajax_target(e.parent(),s);let i=this.overlay,o=this;t("div.referencebrowser a",i.elem).each(function(){let e=t(this);e.attr("ajax:target")&&o.set_selected_on_ajax_target(e,s)})}set_selected_on_ajax_target(e,t){let i=s.ajax.parse_target(e.attr("ajax:target"));i.params.selected=t.join(",");let o=new Array;for(let e in i.params)o.push(e+"="+i.params[e]);e.attr("ajax:target",i.url+"?"+o.join("&"))}}class p extends _{constructor(e,t,s){super(e,t,s),e.off("click").on("click",this.add_reference.bind(this))}add_reference(e){e.preventDefault();let s=this.elem,i=this.target,o=s.attr("id");o=o.substring(4,o.length);let r=t(".reftitle",s.parent()).html();if(this.single_value()){i.attr("value",r);let e='[name="'+i.attr("name")+'.uid"]';return t(e).attr("value",o),this.set_selected_on_ajax_target(i.parent(),[o]),void this.overlay.close()}if(this.multi_value()){if(t('[value="'+o+'"]',i.parent()).length)return;let e=t("<option></option>");e.val(o).html(r).attr("selected","selected"),i.append(e),i.trigger("change")}this.reset_selected(i),this.toggle_enabled(s)}}class m extends _{constructor(e,t,s){super(e,t,s),e.off("click").on("click",this.remove_reference.bind(this))}remove_reference(e){e.preventDefault();let s=this.elem,i=this.target,o=s.attr("id");if(o=o.substring(4,o.length),this.single_value()){i.attr("value","");let e='[name="'+i.attr("name")+'.uid"]';t(e).attr("value","")}if(this.multi_value()){let e='[value="'+o+'"]';if(!t(e,i.parent()).length)return;t(e,i).remove(),i.trigger("change")}this.reset_selected(i),this.toggle_enabled(s)}}class u{static initialize(e){t(".referencebrowser_trigger",e).each(function(){new u(t(this))})}constructor(e){this.wrapper=e.parent();let s=`[name="${e.data("reference-name")}"]`;this.target=t(s,this.wrapper),e.off("click").on("click",this.load_ref_browser.bind(this))}load_ref_browser(e){e.preventDefault(),s.ajax.overlay({action:"referencebrowser",title:"Referencebrowser",css:"modal-lg",target:this.wrapper.attr("ajax:target"),on_complete:this.on_complete.bind(this)}).ref_target=this.target}on_complete(e){let s=this.target;t("a.addreference",e.elem).each(function(){new p(t(this),s,e)}),t("a.removereference",e.elem).each(function(){new m(t(this),s,e)})}}function b(e,t){u.initialize(t)}function f(e,s,i){t(".referencebrowser_trigger",s).each(function(){let s=t(this),o=s.data("reference-name"),r=e.base_id.replace(/\-/g,".");s.data("reference-name",e.set_value_index(o,r,i,"."))})}t(function(){void 0!==window.yafowil_array&&(yafowil_array.on_array_event("on_add",b),yafowil_array.on_array_event("on_index",f))});class g extends s.Events{on_sidebar_left_resize(e){}on_sidebar_right_resize(e){}on_main_area_mode(e){}}const w=new g;class v extends s.Events{static initialize(e){const t=s.query_elem("#main-area",e);t&&new v(t)}constructor(e){super(),this.elem=e,new s.Property(this,"is_compact",null),new s.Property(this,"is_super_compact",null),this.set_mode=this.set_mode.bind(this),w.on("on_sidebar_left_resize",this.set_mode),w.on("on_sidebar_right_resize",this.set_mode),t(window).on("resize",this.set_mode),this.set_mode(),s.ajax.attach(this,e)}destroy(){t(window).off("resize",this.set_mode),w.off("on_sidebar_left_resize",this.set_mode),w.off("on_sidebar_right_resize",this.set_mode)}set_mode(){this.is_compact=this.elem.outerWidth()<992,this.is_super_compact=this.elem.outerWidth()<576}on_is_compact(e){e?(this.elem.removeClass("full"),this.elem.addClass("compact")):(this.elem.removeClass("compact"),this.elem.addClass("full")),w.trigger("on_main_area_mode",this)}on_is_super_compact(e){e?this.elem.addClass("super-compact"):this.elem.removeClass("super-compact"),w.trigger("on_main_area_mode",this)}}class k extends s.Events{constructor(e){super(),this.elem=e,new s.Property(this,"is_compact",null),new s.Property(this,"is_super_compact",null),new s.Property(this,"is_sidebar_collapsed",null),this.set_mode=this.set_mode.bind(this),w.on("on_main_area_mode",this.set_mode),this.on_sidebar_left_resize=this.on_sidebar_left_resize.bind(this),w.on("on_sidebar_left_resize",this.on_sidebar_left_resize),w.on("on_sidebar_right_resize",this.on_sidebar_left_resize),s.ajax.attach(this,e)}destroy(){w.off("on_main_area_mode",this.set_mode),w.off("on_sidebar_left_resize",this.on_sidebar_left_resize),w.off("on_sidebar_right_resize",this.on_sidebar_left_resize)}set_mode(e,t){this.is_compact=t.is_compact,this.is_super_compact=t.is_super_compact}on_is_compact(e){e?(this.elem.removeClass("full"),this.elem.addClass("compact")):(this.elem.removeClass("compact"),this.elem.addClass("full"))}on_is_super_compact(e){e?this.elem.addClass("super-compact"):this.elem.removeClass("super-compact")}on_sidebar_left_resize(e,t){this.is_sidebar_left_collapsed=t.collapsed}on_sidebar_right_resize(e,t){this.is_sidebar_right_collapsed=t.collapsed}on_is_sidebar_left_collapsed(e){}on_is_sidebar_right_collapsed(e){}}const y=e=>class extends e{constructor(...e){super(...e),this.elem&&s.ajax.attach(this,this.elem),this.on_window_resize=this.on_window_resize.bind(this),t(window).on("resize",this.on_window_resize)}on_window_resize(e){super.on_window_resize&&super.on_window_resize(e)}destroy(){try{super.destroy()}catch(e){console.warn(e)}finally{t(window).off("resize",this.on_window_resize)}}};class z extends s.Motion{static initialize(e){t(".scrollable-x",e).each(function(){new x(t(this))}),t(".scrollable-y",e).each(function(){new C(t(this))})}constructor(e){if(super(e),this.elem=e,this.elem.data("scrollbar"))return void console.warn("cone.app: Only one Scrollbar can be bound to each element.");this.elem.data("scrollbar",this),this.content=s.query_elem("> .scrollable-content",e),this.on_scroll=this.on_scroll.bind(this),this.on_click=this.on_click.bind(this),this.on_hover=this.on_hover.bind(this),this.on_window_resize=this.on_window_resize.bind(this),this.compile(),this.position=0,this.scroll_step=50,new s.Property(this,"disabled",!1),s.clock.schedule_frame(()=>this.render());const i=t(window).width()<=768;new s.Property(this,"is_mobile",i)}on_window_resize(e){this.is_mobile=t(window).innerWidth()<=768,this.position=this.safe_position(this.position),this.render()}get position(){return this._position||0}set position(e){this._position=this.safe_position(e),this.update(),this.trigger("on_position",this._position)}get pointer_events(){return"all"===this.elem.css("pointer-events")}set pointer_events(e){this.elem.css("pointer-events",e?"all":"none")}fade_timer(){this.scrollbar.is(":visible")||this.scrollbar.fadeIn("fast"),this.fade_out_timeout&&clearTimeout(this.fade_out_timeout),this.fade_out_timeout=setTimeout(()=>{this.scrollbar.fadeOut("slow")},700)}on_is_mobile(e){e&&this.contentsize>this.scrollsize?(this.scrollbar.stop(!0,!0).show(),this.elem.off("mouseenter mouseleave",this.on_hover)):(this.scrollbar.stop(!0,!0).hide(),this.elem.on("mouseenter mouseleave",this.on_hover))}bind(){this.pointer_events=!0,this.elem.on("mousewheel wheel",this.on_scroll),this.scrollbar.on("click",this.on_click),this.set_scope(this.thumb,t(document),this.elem)}unbind(){this.elem.off("mousewheel wheel",this.on_scroll),this.elem.off("mouseenter mouseleave",this.on_hover),this.scrollbar.off("click",this.on_click),t(this.thumb).off("mousedown",this._down_handle)}destroy(){this.fade_out_timeout&&clearTimeout(this.fade_out_timeout),this.unbind(),this.elem.removeData("scrollbar")}compile(){s.compile_template(this,'\n        <div class="scrollbar" t-elem="scrollbar">\n          <div class="scroll-handle" t-elem="thumb">\n          </div>\n        </div>\n        ',this.elem)}render(e){this.scrollbar.css(e,this.scrollsize),this.contentsize<=this.scrollsize?this.thumbsize=this.scrollsize:this.thumbsize=Math.pow(this.scrollsize,2)/this.contentsize,this.thumb.css(e,this.thumbsize),this.update(),this.position=this.safe_position(this.position)}safe_position(e){if("number"!=typeof e)throw new Error(`Scrollbar position must be a Number, position is: "${e}".`);if(this.contentsize<=this.scrollsize)return 0;const t=this.contentsize-this.scrollsize;return e>=t?e=t:e<=0&&(e=0),e}on_disabled(e){e?this.unbind():this.bind()}on_hover(e){e.preventDefault(),e.stopPropagation();const t=this.elem;(t.has(e.target).length>0||t.is(e.target))&&this.contentsize>this.scrollsize&&("mouseenter"===e.type?this.scrollbar.stop(!0,!0).fadeIn():"mouseleave"===e.type&&e.relatedTarget!==t.get(0)&&this.scrollbar.stop(!0,!0).fadeOut())}on_scroll(e){if(this.contentsize<=this.scrollsize)return;let t=e.originalEvent;"number"==typeof t.deltaY&&(t.deltaY>0?this.position+=this.scroll_step:t.deltaY<0&&(this.position-=this.scroll_step))}on_click(e){e.preventDefault(),this.thumb.addClass("active");let t=this.pos_from_evt(e)-this.offset-this.thumbsize/2;this.position=this.contentsize*t/this.scrollsize,this.thumb.removeClass("active")}touchstart(e){const t=e.originalEvent.touches[0];this._touch_pos=this.pos_from_evt(t),this._start_position=this.position}touchmove(e){if(this.contentsize<=this.scrollsize)return;const t=e.originalEvent.touches[0],s=this.pos_from_evt(t)-this._touch_pos;this.position=this._start_position-s,this.fade_timer()}touchend(e){delete this._touch_pos,delete this._start_position}down(e){this._mouse_pos=this.pos_from_evt(e)-this.offset,this._thumb_pos=this.position/(this.contentsize/this.scrollsize),this.elem.off("mouseenter mouseleave",this.on_hover),this.thumb.addClass("active")}move(e){let t=this.pos_from_evt(e)-this.offset,s=this._thumb_pos+t-this._mouse_pos;this.position=this.contentsize*s/this.scrollsize}up(e){delete this._mouse_pos,delete this._thumb_pos,this.elem.on("mouseenter mouseleave",this.on_hover),this.thumb.removeClass("active")}}class x extends(y(z)){get offset(){return this.elem.offset().left}get contentsize(){return this.content.outerWidth()}get scrollsize(){const e=parseFloat(this.elem.css("padding-right")),t=parseFloat(this.elem.css("padding-left"));return this.elem.outerWidth()-t-e}compile(){super.compile(),this.thumb.css("height","6px"),this.scrollbar.css("height","6px").css("width",this.scrollsize),this.thumbsize=this.scrollsize/(this.contentsize/this.scrollsize),this.thumb.css("width",this.thumbsize)}render(){super.render("width")}update(){let e=this.position/(this.contentsize/this.scrollsize);this.content.css("right",this.position+"px"),this.thumb.css("left",e+"px")}pos_from_evt(e){return e.pageX}}class C extends(y(z)){get offset(){return this.elem.offset().top}get contentsize(){return this.content.outerHeight()}get scrollsize(){const e=parseFloat(this.elem.css("padding-top")),t=parseFloat(this.elem.css("padding-bottom"));return this.elem.outerHeight()-e-t}compile(){super.compile(),this.thumb.css("width","6px"),this.scrollbar.css("width","6px").css("top","0px").css("height",this.scrollsize),this.thumbsize=this.scrollsize/(this.contentsize/this.scrollsize),this.thumb.css("height",this.thumbsize)}render(){super.render("height")}update(){let e=this.position/(this.contentsize/this.scrollsize);this.content.css("bottom",this.position+"px"),this.thumb.css("top",e+"px")}pos_from_evt(e){return e.pageY}}class j{static initialize(e){new j(e)}constructor(e){t("input.add_remove_role_for_principal",e).off("change").on("change",this.set_principal_role)}set_principal_role(e){e.preventDefault();let i,o=t(this);i=this.checked?"add_principal_role":"remove_principal_role";let r=o.parent().attr("ajax:target"),n={id:o.attr("name"),role:o.attr("value")};s.ajax.action({name:i,mode:"NONE",selector:"NONE",url:r,params:n})}}class S extends(y(s.Motion)){constructor(e){super(e),this.elem=e,e.css("width",this.sidebar_width+"px"),this.trigger_event=this.trigger_event.bind(this),this.scrollbar=s.query_elem(".scrollable-y",e).data("scrollbar"),this.on_click=this.on_click.bind(this),this.collapse_elem=s.query_elem("#sidebar_collapse",e),this.collapse_elem.on("click",this.on_click),this.on_lock=this.on_lock.bind(this),this.lock_input=s.query_elem(".lock-state-input",e),this.lock_elem=s.query_elem(".lock-state-btn",e),this.lock_elem.on("click",this.on_lock);const i=s.query_elem("#sidebar_resizer",e);this.set_scope(i,t(document)),this.responsive_toggle=this.responsive_toggle.bind(this),this.responsive_toggle(),void 0!==this.locked&&null!==this.locked&&(this.lock_input.prop("checked",!0).trigger("change"),this.locked.collapsed?this.collapse():this.expand()),t("html, body").css("overscroll-behavior","auto"),s.ajax.attach(this,e)}get collapsed(){return this.elem.outerWidth()<=0}on_window_resize(e){this.responsive_toggle()}on_lock(e){!this.lock_input.get(0).checked?this.set_state():(this.unset_state(),this.elem.removeClass("collapsed"),this.elem.removeClass("expanded")),this.collapsed?this.elem.addClass("collapsed"):this.elem.addClass("expanded")}responsive_toggle(){this.locked||(this.elem.removeClass("collapsed"),this.elem.removeClass("expanded")),this.collapsed?(this.elem.removeClass("responsive-expanded"),this.elem.addClass("responsive-collapsed")):(this.elem.addClass("responsive-expanded"),this.elem.removeClass("responsive-collapsed")),this.collapsed!==this.responsive_collapsed&&(this.responsive_collapsed=this.collapsed,this.trigger_event())}collapse(){t("html, body").css("overscroll-behavior","auto"),this.elem.removeClass("expanded").addClass("collapsed"),this.trigger_event()}expand(){t("html, body").css("overscroll-behavior","none"),this.elem.removeClass("collapsed").addClass("expanded"),this.trigger_event()}on_click(e){this.collapsed?this.expand():this.collapse(),void 0!==this.locked&&null!==this.locked&&this.set_state()}move(e){this.scrollbar.pointer_events=!1,this.sidebar_width=this.get_width_from_event(e),this.elem.css("width",this.sidebar_width),this.trigger_event()}up(){this.scrollbar.pointer_events=!0,this.trigger_event()}destroy(){this.reset_state(),t(window).off("resize",this.on_window_resize),this.collapse_elem.off(),this.scrollbar=null,this.elem.off(),this.lock_elem.off("click",this.on_lock)}}class q extends S{static initialize(e){const t=s.query_elem("#sidebar_left",e);t&&new q(t)}constructor(e){super(e),this.on_sidebar_right_resize=this.on_sidebar_right_resize.bind(this),w.on("on_sidebar_right_resize",this.on_sidebar_right_resize)}get locked(){return JSON.parse(localStorage.getItem("cone.app.sidebar_left.locked"))}get sidebar_width(){return localStorage.getItem("cone-app-sidebar-left-width")||300}set sidebar_width(e){localStorage.setItem("cone-app-sidebar-left-width",e)}trigger_event(){w.trigger("on_sidebar_left_resize",this)}get_width_from_event(e){let s=e.pageX,i=0;t("#sidebar_right").length>0&&(i=t("#sidebar_right").outerWidth());const o=t(window).width()-i-300;return s=Math.max(115,Math.min(s,o)),parseInt(s)}on_sidebar_right_resize(e,s){const i=t(window).width()-this.elem.outerWidth()-300;!s.collapsed&&t(window).width()<768?(this.collapse(),this.elem.addClass("d-none")):!s.collapsed&&s.elem.outerWidth()>=i?this.collapse():s.collapsed&&this.elem.removeClass("d-none")}set_state(){console.log(this.collapsed),localStorage.setItem("cone.app.sidebar_left.locked",JSON.stringify({collapsed:this.collapsed}))}unset_state(){localStorage.removeItem("cone.app.sidebar_left.locked")}destroy(){super.destroy(),w.off("on_sidebar_right_resize",this.on_sidebar_right_resize)}}class I extends S{static initialize(e){const t=s.query_elem("#sidebar_right",e);t&&new I(t)}constructor(e){super(e),this.on_sidebar_left_resize=this.on_sidebar_left_resize.bind(this),w.on("on_sidebar_left_resize",this.on_sidebar_left_resize)}get locked(){return JSON.parse(localStorage.getItem("cone.app.sidebar_right.locked"))}get sidebar_width(){return localStorage.getItem("cone-app-sidebar-right-width")||300}set sidebar_width(e){localStorage.setItem("cone-app-sidebar-right-width",e)}trigger_event(){w.trigger("on_sidebar_right_resize",this)}get_width_from_event(e){let s=t(window).outerWidth()-e.pageX,i=0;t("#sidebar_left").length>0&&(i=t("#sidebar_left").outerWidth());const o=t(window).width()-i-300;return s=Math.max(115,Math.min(s,o)),parseInt(s)}on_sidebar_left_resize(e,s){const i=t(window).width()-this.elem.outerWidth()-300;!s.collapsed&&t(window).width()<768?(this.collapse(),this.elem.addClass("d-none")):!s.collapsed&&s.elem.outerWidth()>=i?this.collapse():s.collapsed&&this.elem.removeClass("d-none")}set_state(){console.log(this.collapsed),localStorage.setItem("cone.app.sidebar_right.locked",JSON.stringify({collapsed:this.collapsed}))}unset_state(){localStorage.removeItem("cone.app.sidebar_right.locked")}destroy(){super.destroy(),w.off("on_sidebar_left_resize",this.on_sidebar_left_resize)}}class E{static initialize(e){o.initialize(e,".table_length select"),r.initialize(e,".table_filter input")}}class N{static initialize(e){t(".translation-nav",e).each(function(){new N(t(this))})}constructor(e){t("div.invalid-feedback",e.parent()).show(),this.nav_elem=e,this.fields_elem=e.next(),this.show_lang_handle=this.show_lang_handle.bind(this),t("li > a",e).on("click",this.show_lang_handle),t("li.error",e).length?t("li.error:first > a",e).trigger("click"):t("li > a.active",e).trigger("click"),this.fields_elem.show()}show_lang_handle(e){e.preventDefault(),t("li > a",this.nav_elem).removeClass("active"),this.fields_elem.children().hide();let s=t(e.currentTarget);s.addClass("active"),t(s.attr("href"),this.fields_elem).show()}}class T extends k{static initialize(e){const t=s.query_elem("#mainmenu",e);t&&new T(t)}constructor(e){super(e),this.elem=e,this.scrollbar=e.data("scrollbar"),this.elems=t(".nav-link.dropdown-toggle",e),this.open_dropdown=null,this.on_show_dropdown_desktop=this.on_show_dropdown_desktop.bind(this),this.on_hide_dropdown_desktop=this.on_hide_dropdown_desktop.bind(this),this.hide_dropdowns=this.hide_dropdowns.bind(this),this.scrollbar.on("on_position",this.hide_dropdowns)}get height(){return this.elem.outerHeight(!0)}on_sidebar_left_resize(e,t){super.on_sidebar_left_resize(e,t),requestAnimationFrame(()=>{this.scrollbar.render()})}on_is_compact(e){this.hide_dropdowns(),e?(this.scrollbar.off("on_position",this.hide_dropdowns),this.bind_dropdowns_mobile()):(this.bind_dropdowns_desktop(),this.scrollbar.on("on_position",this.hide_dropdowns))}on_show_dropdown_desktop(e){const s=e.target;this.open_dropdown=s;t(s).siblings("ul.dropdown-menu").css({top:this.height-1+"px",left:`${t(s).offset().left}px`})}on_hide_dropdown_desktop(e){const t=e.target;this.open_dropdown===t&&(this.open_dropdown=null)}bind_dropdowns_desktop(){this.elem.on("shown.bs.dropdown",".nav-link.dropdown-toggle",this.on_show_dropdown_desktop),this.elem.on("hidden.bs.dropdown",".nav-link.dropdown-toggle",this.on_hide_dropdown_desktop)}bind_dropdowns_mobile(){this.elem.off("shown.bs.dropdown",".nav-link.dropdown-toggle",this.on_show_dropdown_desktop),this.elem.off("hidden.bs.dropdown",".nav-link.dropdown-toggle",this.on_hide_dropdown_desktop)}hide_dropdowns(){this.elems.each((e,s)=>{t(s).dropdown("hide")})}destroy(){super.destroy(),this.elem.off("shown.bs.dropdown",".nav-link.dropdown-toggle",this.on_show_dropdown_desktop),this.elem.off("hidden.bs.dropdown",".nav-link.dropdown-toggle",this.on_hide_dropdown_desktop),this.scrollbar.off("on_position",this.hide_dropdowns),this.scrollbar.destroy()}}class D extends k{static initialize(e){const t=s.query_elem("#header-main",e);t&&new D(t)}constructor(e){super(e),this.elem=e,this.header_content=s.query_elem("#header-content",e),this.navbar_content_wrapper=s.query_elem("#navbar-content-wrapper",e),this.navbar_content=s.query_elem("#navbar-content",e),this.navbar_toggler=s.query_elem("#navbar-toggler",this.elem),this.personal_tools=s.query_elem("#personaltools",e),this.mainmenu=s.query_elem("#mainmenu",e),this.mainmenu_elems=t(".nav-link.dropdown-toggle",this.mainmenu),this.render_mobile_scrollbar=this.render_mobile_scrollbar.bind(this),this.mainmenu_elems.each((e,s)=>{t(s).on("shown.bs.dropdown",this.render_mobile_scrollbar),t(s).on("hidden.bs.dropdown",this.render_mobile_scrollbar)}),this.set_mobile_menu_open=this.set_mobile_menu_open.bind(this),this.set_mobile_menu_closed=this.set_mobile_menu_closed.bind(this),this.bind()}destroy(){super.destroy(),this.mobile_scrollbar&&(this.mobile_scrollbar.destroy(),this.mobile_scrollbar=null),this.mainmenu_elems.each((e,s)=>{t(s).off("shown.bs.dropdown",this.render_mobile_scrollbar),t(s).off("hidden.bs.dropdown",this.render_mobile_scrollbar)});const e=this.navbar_content_wrapper;e.off("show.bs.collapse shown.bs.collapse",this.set_mobile_menu_open),e.off("hide.bs.collapse hidden.bs.collapse",this.set_mobile_menu_closed)}render_mobile_scrollbar(){this.is_compact&&this.mobile_scrollbar&&this.mobile_scrollbar.render()}bind(){const e=this.navbar_content_wrapper;e.on("show.bs.collapse shown.bs.collapse",this.set_mobile_menu_open),e.on("hidden.bs.collapse",this.set_mobile_menu_closed)}set_mobile_menu_open(){this.elem.addClass("mobile-menu-open")}set_mobile_menu_closed(){this.elem.removeClass("mobile-menu-open")}on_is_compact(e){this.mobile_scrollbar&&(this.navbar_content.removeClass("scrollable-content"),this.mobile_scrollbar.destroy(),this.mobile_scrollbar=null),e?(this.elem.removeClass("full").removeClass("navbar-expand"),this.elem.addClass("compact"),this.navbar_content.addClass("scrollable-content"),this.mobile_scrollbar=new C(this.navbar_content_wrapper),this.navbar_content_wrapper.on("shown.bs.collapse",()=>{t("html, body").css("overscroll-behavior","none"),this.mobile_scrollbar.render()}),this.navbar_content_wrapper.on("hide.bs.collapse",()=>{t("html, body").css("overscroll-behavior","auto"),this.mobile_scrollbar.scrollbar.hide()})):(this.elem.removeClass("compact"),this.elem.addClass("full").addClass("navbar-expand"))}on_is_super_compact(e){const i=null!==s.query_elem("#personaltools",this.navbar_content);e?i||this.personal_tools.detach().appendTo(this.navbar_content):(i&&this.personal_tools.detach().prependTo(this.header_content),t(".dropdown-menu.show").removeClass("show"))}}class M{static initialize(e){const t=s.query_elem("#navtree",e);t&&new M(t)}constructor(e){this.elem=e,this.dropdown_elem=t("#navigation-collapse",e),this.dropdown_elem.hasClass("no-collapse")||(localStorage.getItem("cone.app.navtree.open")&&this.dropdown_elem.addClass("show"),this.set_menu_open=this.set_menu_open.bind(this),this.set_menu_closed=this.set_menu_closed.bind(this),this.dropdown_elem.on("shown.bs.collapse",this.set_menu_open),this.dropdown_elem.on("hidden.bs.collapse",this.set_menu_closed),s.ajax.attach(this,e))}set_menu_open(e){localStorage.setItem("cone.app.navtree.open","true")}set_menu_closed(e){localStorage.removeItem("cone.app.navtree.open")}destroy(){this.dropdown_elem.off(),this.elem.off()}}class W{constructor(e){this.options=e,this.selected=[],this.select_direction=0,this.firstclick=!0}reset(){this.selected=[]}add(e){this.remove(e),this.selected.push(e)}remove(e){let s=t.grep(this.selected,function(t,s){return t!==e});this.selected=s}select_no_key(e,t){e.children().removeClass("selected"),t.addClass("selected"),this.reset(),this.add(t.get(0))}select_ctrl_down(e){e.toggleClass("selected"),e.hasClass("selected")?this.add(e.get(0)):this.remove(e.get(0))}get_nearest(e,s){let i,o,r=e.children(".selected"),n=-1;return t(r).each(function(){o=t(this),i=o.index(),-1==n?n=i:s>i?this.select_direction>0?i<n&&(n=i):i>n&&(n=i):s<i&&i<n&&(n=i)}),n}select_shift_down(e,t){let s=t.index(),i=this.get_nearest(e,s);if(-1==i)t.addClass("selected"),this.add(t.get(0));else{let t,o;e.children().removeClass("selected"),s<i?(this.select_direction=-1,t=s,o=i):(this.select_direction=1,t=i,o=s),this.reset();let r=this;e.children().slice(t,o+1).addClass("selected").each(function(){r.add(this)})}}handle_click(e){e.preventDefault();let s=t(e.currentTarget),i=s.parent();h.ctrl_down||h.shift_down?h.ctrl_down?this.select_ctrl_down(s):h.shift_down&&this.select_shift_down(i,s):this.select_no_key(i,s),this.firstclick&&(this.firstclick=!1,this.notify("on_firstclick",this,s)),this.notify("on_select",this)}notify(e,...t){this.options&&this.options[e]&&this.options[e](...t)}bind(e){e.off("click").on("click",this.handle_click.bind(this))}}function O(e,t,i){s.deprecate("createCookie","ts.create_cookie","1.1"),s.create_cookie(e,t,i)}function A(e){return s.deprecate("readCookie","ts.read_cookie","1.1"),s.read_cookie(e)}return t.fn.selectable=function(e){var t=new W(e);return t.bind(this),this.data("selectable",t),this},t(function(){new c,new n,s.ajax.register(o.initialize,!0),s.ajax.register(r.initialize,!0),s.ajax.register(a.initialize,!0),s.ajax.register(u.initialize,!0),s.ajax.register(_.initialize,!0),s.ajax.register(j.initialize,!0),s.ajax.register(E.initialize,!0),s.ajax.register(N.initialize,!0),s.ajax.register(l.initialize,!0),s.ajax.register(z.initialize,!0),s.ajax.register(d.initialize,!0),s.ajax.register(T.initialize,!0),s.ajax.register(D.initialize,!0),s.ajax.register(v.initialize,!0),s.ajax.register(q.initialize,!0),s.ajax.register(I.initialize,!0),s.ajax.register(M.initialize,!0)}),e.AddReferenceHandle=p,e.BatchedItemsFilter=i,e.BatchedItemsSearch=r,e.BatchedItemsSize=o,e.ColorMode=n,e.ColorToggler=l,e.CopySupport=a,e.GlobalEvents=g,e.Header=D,e.KeyBinder=c,e.LayoutAware=k,e.LiveSearch=d,e.MainArea=v,e.MainMenu=T,e.NavTree=M,e.ReferenceBrowserLoader=u,e.ReferenceHandle=_,e.RemoveReferenceHandle=m,e.ResizeAware=y,e.Scrollbar=z,e.ScrollbarX=x,e.ScrollbarY=C,e.Selectable=W,e.Sharing=j,e.Sidebar=S,e.SidebarLeft=q,e.SidebarRight=I,e.TableToolbar=E,e.Translation=N,e.batcheditems_filter_binder=function(e,t,i){s.deprecate("batcheditems_filter_binder","BatchedItems.bind_search","1.1"),t||(t=".batched_items_filter input"),i||(i="term"),r.initialize(e,t,i)},e.batcheditems_handle_filter=function(e,t,o){s.deprecate("batcheditems_handle_filter","BatchedItems.set_filter","1.1"),new i(e,t).set_filter(o)},e.batcheditems_size_binder=function(e,t){s.deprecate("batcheditems_size_binder","BatchedItems.bind_size","1.1"),t||(t=".batched_items_slice_size select"),o.initialize(e,t)},e.createCookie=O,e.global_events=w,e.keys=h,e.readCookie=A,Object.defineProperty(e,"__esModule",{value:!0}),window.createCookie=O,window.readCookie=A,e}({},jQuery,treibstoff);
